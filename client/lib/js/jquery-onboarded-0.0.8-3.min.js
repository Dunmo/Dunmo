/*! Onboarded jQuery Plugin - v0.0.8-3 - 2015-04-04
* www.getonboarded.com

* Copyright (c) 2015 Evan Marell;
Licensed MIT */(function(){!function(a){return null==a.Onboarded&&(a.Onboarded={}),a.Onboarded.API=function(){function b(){}var c,d;return d=null,c=function(){function b(a){this.setConfig(a)}return b.prototype.defaults={protocol:"https",host:"www.getonboarded.com",prefix:"api"},b.prototype.endpoints={obRegister:"projects",obRegisterFlow:"projects/flows",obFlowData:"flows/steps"},b.prototype.setConfig=function(b){return this.config=a.extend({},this.defaults,b)},b.prototype.updateConfig=function(b){return this.config=a.extend({},this.config,b)},b.prototype.baseUrl=function(){return null!=this._baseUrl?this._baseUrl:this._baseUrl=""+this.protocol()+this.host()+this.port()+"/"+this.prefix()},b.prototype.protocol=function(){return null!=this._protocol?this._protocol:this._protocol=""+this.config.protocol+"://"},b.prototype.host=function(){return null!=this._host?this._host:this._host=this.config.host},b.prototype.port=function(){return null!=this._port?this._port:this._port=this.config.port&&":"+this.config.port||""},b.prototype.prefix=function(){return null!=this._prefix?this._prefix:this._prefix=""+this.config.prefix+"/"},b.prototype.endpointFor=function(a){return""+this.baseUrl()+this.endpoints[a]},b}(),b.getLookup=function(a){return null!=d?d:d=new c(a)},b.destroyLookup=function(){return d=null},b}(),a.Onboarded.APIAcceptVersion=function(b){var c;return c="application/vnd.example.v"+b,a.ajaxPrefilter(function(a){return a.beforeSend?void 0:a.beforeSend=function(a){return a.setRequestHeader("Accept",c)}})}}(window.jQuery,window)}).call(this),function(){!function(a){return null==a.Onboarded&&(a.Onboarded={}),a.Onboarded.DSL={obContainer:"data-onboarded-token",obProjectToken:"data-onboarded-token",obUser:"data-onboarded-user",obFlow:"data-onboarded-flow",obStep:"data-step",obStepSequence:"data-step-sequence",obComplete:"data-complete",obName:"data-name",obNextStep:"data-action-next",obFinish:"data-action-complete"}}(window.jQuery,window)}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};!function(b){return null==b.Onboarded&&(b.Onboarded={}),b.Onboarded.Flow=function(){function c(a,c){this.dsl=null!=c?c:null,null==this.dsl&&(this.dsl=b.Onboarded.DSL),null==this.api&&(this.api=b.Onboarded.API.getLookup()),this.error=!1,this.$flow=b(a),this._parseLabel(),this._parseSteps(),this.current_step=this.setCurrentStep(),this.deferredRender=null,this.complete=!1,this._parseCompletionContent()}return c.prototype._initializeStepOrder=function(){return this.step_order=[]},c.prototype._initializeSteps=function(){return this.steps={}},c.prototype._initializeCompletedSteps=function(){return this.completed_steps=[]},c.prototype._parseLabel=function(){return this.label=this.$flow.attr(this.dsl.obFlow)},c.prototype._parseSteps=function(){var a,c,d,e,f,g;for(this._initializeStepOrder(),this._initializeSteps(),this._initializeCompletedSteps(),d=this.$flow.find("["+this.dsl.obStep+"]"),g=[],e=0,f=d.length;f>e;e++)c=d[e],a=b(c).attr(this.dsl.obStep),this.step_order.push(a),g.push(this.steps[a]=new b.Onboarded.Step(c));return g},c.prototype._parseCompletionContent=function(){var a;return a=this.$flow.find("["+this.dsl.obComplete+"]"),this.completionContent=a.length>0&&a||!1},c.prototype.setCurrentStep=function(a){var b,c,d,e,f,g;for(null==a&&(a=""),a=this._useOrGetDefault(a),g=this.completed_steps,e=0,f=g.length;f>e;e++){d=g[e];for(b in d)c=d[b],a===b&&(a=c)}return this.current_step=a},c.prototype._useOrGetDefault=function(b){var c;return c=this._stepLabels(),a.call(c,b)>=0&&b||c[0]},c.prototype._stepLabels=function(){return Object.keys(this.steps)},c.prototype.getStep=function(){return this.steps[this.current_step]},c.prototype._getStepContent=function(){return this.getStep().start()},c.prototype._getCompletionContent=function(){var a,c,d,e,f,g,h;if(!this.completionContent)return!1;for(a=this.completionContent.clone(!0,!0),e=this.completionContent.closest("["+this.dsl.obContainer+"]").get(),h=this.completionContent.parentsUntil(e),f=0,g=h.length;g>f;f++)d=h[f],a=b(d).clone(!0,!0).empty().append(a);return c=b(e).clone(!0,!0).show(),c.empty().append(a)},c.prototype.getContent=function(){return this.error?!1:this.current_step.complete?this._getCompletionContent():this._getStepContent()},c.prototype.sendDataFor=function(a,c){var d;return d={step:a,userToken:c,flow:{label:this.label}},b.post(this.api.endpointFor("obFlowData"),d).fail(function(a,b,c){return"Forbidden"===c?(console.warn(a.responseJSON.message),console.info("Please visit "+a.responseJSON.plans_url+" for more information.")):void 0})},c.prototype._newDeferredRender=function(){return new b.Deferred},c.prototype._getPromiseToRender=function(){return this.deferredRender.promise()},c.prototype.startCheckAndGetContentFor=function(a){return b.Callbacks("once").add(function(a){return function(){return b(document).trigger("onboarded:flow:onStart",[a])}}(this)).add(function(b){return function(){return b.deferredRender=b._newDeferredRender(),b._registerFor(a)}}(this)).add(function(a){return function(){return b(document).trigger("onboarded:flow:afterStart",[a])}}(this)).fire(),this._getPromiseToRender()},c.prototype._registerFor=function(a){var c;return c={userToken:a,flow:{label:this.label,steps:this._stepLabels()}},b.post(this.api.endpointFor("obRegisterFlow"),c).done(function(a){return function(b){return b.completed&&a.setComplete(),null!=b.completed_steps&&b.completed_steps.length&&a.setCompletedSteps(b.completed_steps),a.setCurrentStep()}}(this)).fail(function(a){return function(b){return a.error=b}}(this)).always(function(a){return function(){return a.deferredRender.resolve(a.getContent())}}(this))},c.prototype.startAndGetContent=function(){return b.Callbacks("once").add(function(a){return function(){return b(document).trigger("onboarded:flow:onStart",[a])}}(this)).add(function(a){return function(){return a.deferredRender=a._newDeferredRender(),a.deferredRender.resolve(a.getContent())}}(this)).add(function(a){return function(){return b(document).trigger("onboarded:flow:afterStart",[a])}}(this)).fire(),this._getPromiseToRender()},c.prototype.reset=function(){return b.Callbacks("once").add(function(a){return function(){return b(document).trigger("onboarded:flow:onReset",[a])}}(this)).add(function(a){return function(){var b,c,d,e;a.complete=!1,a._initializeCompletedSteps(),a.setCurrentStep(),d=a.steps,e=[];for(b in d)c=d[b],e.push(c.resetNamedData());return e}}(this)).add(function(a){return function(){return b(document).trigger("onboarded:flow:afterReset",[a])}}(this)).fire(),this},c.prototype.dismiss=function(){return b.Callbacks("once").add(function(a){return function(){return b(document).trigger("onboarded:flow:onDismissal",[a,a.getStep()])}}(this)).add(function(){return function(){return b(document).trigger("dismissFlow.onboarded")}}(this)).add(function(a){return function(){return b(document).trigger("onboarded:flow:afterDismissal",[a,a.getStep()])}}(this)).fire(),this},c.prototype.setComplete=function(){return b.Callbacks("once").add(function(a){return function(){return b(document).trigger("onboarded:flow:onComplete",[a])}}(this)).add(function(a){return function(){return a.complete=!0,a.current_step={complete:a.complete}}}(this)).add(function(a){return function(){return b(document).one("contentRendered.onboarded",function(){return b(document).trigger("onboarded:flow:afterComplete",[a])})}}(this)).fire(),this},c.prototype.setCompletedSteps=function(a){return this.completed_steps=a},c}()}(window.jQuery,window)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};!function(c){return null==c.Onboarded&&(c.Onboarded={}),c.Onboarded.Step=function(){function d(b,d){this.dsl=null!=d?d:null,this._extraDataForTrigger=a(this._extraDataForTrigger,this),this._submitFormHandler=a(this._submitFormHandler,this),this._clickActionHandler=a(this._clickActionHandler,this),this._handleDataChange=a(this._handleDataChange,this),this._getNamedKeyFor=a(this._getNamedKeyFor,this),null==this.dsl&&(this.dsl=c.Onboarded.DSL),this.$step=c(b),this._bindFormSubmit(),this._parseStep()}return d.prototype._bindFormSubmit=function(){return this.$step.find("form").on("submit",this._submitFormHandler)},d.prototype._parseStep=function(){return this.namedKeys=[],this.data={},this.actions={},this._parseLabel(),this._parseNamedData(),this._parseActions()},d.prototype._parseLabel=function(){return this.label=this.$step.attr(this.dsl.obStep)},d.prototype._parseNamedData=function(){var a,b,d,e,f,g,h;for(this.$namedData=this.$step.find("["+this.dsl.obName+"], input, select, textarea"),g=this.$namedData,h=[],e=0,f=g.length;f>e;e++)b=g[e],a=c(b),d=this._getNamedKeyFor(a),this.namedKeys.push(d),this.data[d]=!1,h.push(a.on("change",{changedKey:d},this._handleDataChange));return h},d.prototype.resetNamedData=function(){var a,b,c,d;c=this.data,d=[];for(b in c)a=c[b],d.push(this.data[b]=!1);return d},d.prototype._getNamedKeyFor=function(a){var b,d;return b=c(a),null!=(d=b.attr(this.dsl.obName))?d:b.attr("name").replace(/\[\]$/,"["+b.val()+"]")},d.prototype._handleDataChange=function(a){var b,d;return b=c(a.target),d=this._getNamedKeyFor(a.target),this.data[d]=function(){switch(a.target.type){case"checkbox":return b.prop("checked");default:return b.val()}}()},d.prototype._getActions=function(a){return null==a&&(a=null),a=a&&"="+a||"",this.$step.find("["+this.dsl.obNextStep+a+"], ["+this.dsl.obFinish+a+"]")},d.prototype._parseActions=function(){var a,d,e,f,g,h,i,j;for(e=this._getActions(),j=[],h=0,i=e.length;i>h;h++)d=e[h],a=c(d),g=this.nextFor(a),f=a.attr(this.dsl.obName),b.call(this.namedKeys,f)>=0?(a.on("click",this._clickActionHandler),j.push(this.actions[f]=g)):j.push(void 0);return j},d.prototype._clickActionHandler=function(a){var b,d,e;return a.preventDefault(),b=c(a.target),e=this.nextFor(b),d=b.attr(this.dsl.obName),this._negateNamedDataValue(d),this._finishAndProceedTo(e)},d.prototype._negateNamedDataValue=function(a){return this.data[a]=!this.data[a]},d.prototype._submitFormHandler=function(a){return a.preventDefault()},d.prototype._extraDataForTrigger=function(a){var b;return null==a&&(a=null),b={label:this.label,data:this.data},null!=a&&(b.action=a),b},d.prototype.start=function(){return c.Callbacks("once").add(function(a){return function(){return c(document).trigger("onboarded:step:onStart",[a,a.data])}}(this)).add(function(a){return function(){return c(document).trigger("startedStep.onboarded",[a._extraDataForTrigger()])}}(this)).add(function(a){return function(){return c(document).trigger("onboarded:step:afterStart",[a,a.data])}}(this)).fire(),this.getContent()},d.prototype._finishAndProceedTo=function(a){return c.Callbacks("once").add(function(a){return function(){return c(document).trigger("onboarded:step:onComplete",[a,a.data])}}(this)).add(function(b){return function(){return c(document).trigger("finishedStep.onboarded",[b._extraDataForTrigger(a)]),a.complete&&c(document).trigger("flowComplete.onboarded"),c(document).trigger("nextStep.onboarded",[a])}}(this)).add(function(a){return function(){return c(document).trigger("onboarded:step:afterComplete",[a,a.data])}}(this)).fire()},d.prototype.getData=function(a){return null==a&&(a=null),null!=a?this.data[a]:this.data},d.prototype.getContent=function(){var a,b,d,e,f,g,h;for(a=this.$step.clone(!0,!0),e=this.$step.closest("["+this.dsl.obContainer+"]").get(),h=this.$step.parentsUntil(e),f=0,g=h.length;g>f;f++)d=h[f],a=c(d).clone(!0,!0).empty().append(a);return b=c(e).clone(!0,!0).show(),b.empty().append(a)},d.prototype.nextFor=function(a){var b;return b="string"==typeof a&&this._getActions(a)||a,""===b.attr(this.dsl.obFinish)&&{complete:!0}||b.attr(this.dsl.obNextStep)},d}()}(window.jQuery,window)}.call(this),function(){!function(a,b){return null==a.Onboarded&&(a.Onboarded={}),a.Onboarded.UserProperties=function(){function c(){this.blackberry=/(BlackBerry|PlayBook|BB10)/i,this.iOS=/(iPhone|iPad|iPod)/,this.referrer=document.referrer,this.windowConsole=b.console,this.navigator=b.navigator,this.document=b.document,this.userAgent=navigator.userAgent,this.geoLocationResponse=null,this.geolocate()}return c.prototype._includes=function(a,b){return~a.indexOf(b)},c.prototype._getQueryParam=function(a,b){var c,d,e;return b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),d="[\\?&]"+b+"=([^&#]*)",c=new RegExp(d),e=c.exec(a),null===e||e&&"string"!=typeof e[1]&&e[1].length?"":decodeURIComponent(e[1]).replace(/\+/g," ")},c.prototype.browser=function(){var a,c;return c=this.navigator.vendor||"",a=b.opera,a?this._includes(this.userAgent,"Mini")&&"Opera Mini"||"Opera":this.blackberry.test(this.userAgent)?"BlackBerry":this._includes(this.userAgent,"FBIOS")?"Facebook Mobile":this._includes(this.userAgent,"Chrome")?"Chrome":this._includes(this.userAgent,"CriOS")?"Chrome iOS":this._includes(c,"Apple")?this._includes(this.userAgent,"Mobile")&&"Mobile Safari"||"Safari":this._includes(this.userAgent,"Android")?"Android Mobile":this._includes(this.userAgent,"Konqueror")?"Konqueror":this._includes(this.userAgent,"Firefox")?"Firefox":this._includes(this.userAgent,"MSIE")||this._includes(this.userAgent,"Trident/")?"Internet Explorer":this._includes(this.userAgent,"Gecko")?"Mozilla":""},c.prototype.os=function(){return/Windows/i.test(this.userAgent)?/Phone/.test(this.userAgent)&&"Windows Mobile"||"Windows":this.iOS.test(this.userAgent)?"iOS":/Android/.test(this.userAgent)?"Android":this.blackberry.test(this.userAgent)?"BlackBerry":/Mac/i.test(this.userAgent)?"Mac OS X":/Linux/.test(this.userAgent)?"Linux":""},c.prototype.device=function(){return/iPad/.test(this.userAgent)?"iPad":/iPod/.test(this.userAgent)?"iPod Touch":/iPhone/.test(this.userAgent)?"iPhone":/(BlackBerry|PlayBook|BB10)/i.test(this.userAgent)?"BlackBerry":/Windows Phone/i.test(this.userAgent)?"Windows Phone":/Android/.test(this.userAgent)?"Android":""},c.prototype.referringDomain=function(){var a;return a=this.referrer.split("/"),a.length>=3&&a[2]||""},c.prototype.searchEngine=function(){return 0===this.referrer.search("https?://(.*)google.([^/?]*)")?"google":0===this.referrer.search("https?://(.*)bing.com")?"bing":0===this.referrer.search("https?://(.*)yahoo.com")?"yahoo":0===this.referrer.search("https?://(.*)duckduckgo.com")?"duckduckgo":null},c.prototype.searchInfo=function(){var a,b,c,d;return d=this.searchEngine(this.referrer),b="yahoo"!==d&&"q"||"p",c={},null!=d&&(c["Search Engine"]=d,a=this._getQueryParam(this.referrer,b),a.length&&(c.Keyword=a)),c},c.prototype.geolocate=function(){return a.get("https://freegeoip.net/json/",function(a){return function(b){return a.geoLocationResponse=b}}(this))},c.prototype.currentPageLocation=function(){var a;return a={origin:b.location.origin,protocol:b.location.protocol,hostname:b.location.hostname,port:b.location.port,pathname:b.location.pathname,search:b.location.search}},c.prototype.getAll=function(){return null!=this.properties?this.properties:this.properties={Location:this.geoLocationResponse,"Current Page":this.currentPageLocation(),Referrer:this.referrer,"Referring Domain":this.referringDomain(),"Search Info":this.searchInfo(),Device:this.device(),OS:this.os(),Browser:this.browser(),"Screen Height":a(b).height(),"Screen Width":a(b).width()}},c}()}(window.jQuery,window)}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};jQuery(function(){return $.Onboarded||($.Onboarded={}),$.Onboarded.onboard=function(b,c){var d;return null==this.dsl&&(this.dsl=$.Onboarded.DSL),this.$container=!1,this.flows={},this.flow_order=[],d="",this.current_flow=null,this.settings={},this.$element=$(b),this.registered_user=!1,this.user_properties=null,this.setState=function(a){return d=a},this.getState=function(){return d},this.getSetting=function(a){return this.settings[a]},this.callSettingFunction=function(a,b){return null==b&&(b=[]),this.settings[a].apply(this,b)},this.parseContainer=function(){return this.$container=$("["+this.dsl.obContainer+"]").hide()},this.parseProjectToken=function(){return this.project_token=this.$container.attr(this.dsl.obProjectToken)},this.getProjectToken=function(){return this.project_token},this.parseUser=function(){var a;return a=this.$container.attr(this.dsl.obUser),this.user=null!=a&&a},this.getParsedUser=function(){return this.user},this.getUser=function(){return this.registered_user||this.getParsedUser()},this.parseFlows=function(){var a,b,c,d,e,f;for(e=this.$container.find("["+this.dsl.obFlow+"]"),f=[],c=0,d=e.length;d>c;c++)a=e[c],b=$(a).attr(this.dsl.obFlow),this.flow_order.push(b),f.push(this.flows[b]=new $.Onboarded.Flow(a));return f},this.addRenderContainer=function(){return this.renderContainer=$("<div>").hide().prependTo($(document.body))},this.setCurrentFlow=function(b){var c;return null==b&&(b=""),c=Object.keys(this.flows),this.current_flow=a.call(c,b)>=0&&b||c[0]},this.getFlow=function(){return this.flows[this.current_flow]},this._setCurrentStepOfFlow=function(a){return null==a&&(a=""),this.getFlow().setCurrentStep(a)},this._getCurrentStepOfFlow=function(){return this.getFlow().current_step},this._completeCurrentFlow=function(){return this.getFlow().setComplete()},this._getContentFromFlow=function(){return this.getFlow().getContent()},this._flowIsComplete=function(){return this.getFlow().complete},this.resetFlow=function(){return this.getFlow().reset(),this},this.dismissFlow=function(){return this.getFlow().dismiss(),this},this._startFlowCheckAndGetContentFor=function(a){return this.getFlow().startCheckAndGetContentFor(a)},this._startFlowAndGetContent=function(){return this.getFlow().startAndGetContent()},this.updateRenderContainer=function(a){return $.Callbacks("once").add(function(b){return function(){return $(document).trigger("onboarded:onRender",[a,b.renderContainer])}}(this)).add(function(b){return function(){return a?$(b.renderContainer).html(a).show():$(b.renderContainer).hide().empty(),$(document).trigger("contentRendered.onboarded",[b.renderContainer])}}(this)).add(function(b){return function(){return $(document).trigger("onboarded:afterRender",[a,b.renderContainer])}}(this)).fire(),this},this.gotoStep=function(a){return function(b,c){return c.complete?a._completeCurrentFlow():a._setCurrentStepOfFlow(c),a.updateRenderContainer(a._getContentFromFlow())}}(this),this.postData=function(a){return function(b,c){return c=$.extend(c,{properties:a.user_properties.getAll()}),a.registered_user?a.getFlow().sendDataFor(c,a.getUser()):void 0}}(this),this._emptyAndHideRenderContainer=function(a){return function(){return a.updateRenderContainer(!1),a}}(this),this.bindEventHandlers=function(){return $(document).off("startedStep.onboarded").on("startedStep.onboarded",this.postData).off("finishedStep.onboarded").on("finishedStep.onboarded",this.postData).off("nextStep.onboarded").on("nextStep.onboarded",this.gotoStep).off("dismissFlow.onboarded").on("dismissFlow.onboarded",this._emptyAndHideRenderContainer)},this.startFlow=function(a){var b,c,d;return null==a&&(a={}),b=a.label||"",d=a.skipApiCheck||!1,c=a.reset||!1,this.bindEventHandlers(),this.setCurrentFlow(b),this.deferredRegistration.done(function(a){return function(e){return d?(console.info("Starting "+b+" flow without checking API for the current user status..."),c&&a.resetFlow(),a._startFlowAndGetContent().done(function(b){return a.updateRenderContainer(b)})):(console.info("Starting "+b+" flow..."),a._startFlowCheckAndGetContentFor(e).done(function(b){return a.updateRenderContainer(b)})),a.setState("started")}}(this)).fail(function(a){return function(){return console.info("Starting "+b+" flow without API connection..."),c&&a.resetFlow(),a._startFlowAndGetContent().done(function(b){return a.updateRenderContainer(b)}),a.setState("started without API")}}(this)),this.getFlow()},this.register=function(){var a;return a={user:this.getUser(),project:{token:this.getProjectToken()}},this.deferredRegistration=this._newDeferredRegistration(),this.registered_user?void 0:this._postToRegistrationEndpoint(a).done(function(a){return function(b){return a.setRegisteredUser(b.user)}}(this)).fail(function(a){return function(b){return console.warn("Could not connect to the API. No data will be collected."),a.deferredRegistration.reject(b)}}(this))},this._postToRegistrationEndpoint=function(a){return $.post(this.api.endpointFor("obRegister"),a)},this.setRegisteredUser=function(a){return this.registered_user=a,this.deferredRegistration.resolve(this.registered_user)},this._newDeferredRegistration=function(){return new $.Deferred},this.setAPIVersion=function(){return $.Onboarded.APIAcceptVersion(this.settings.apiVersion)},this.init=function(){return $.Callbacks("once").add(function(a){return function(){return a.settings=$.extend({},a.defaults,c),null==a.api&&(a.api=$.Onboarded.API.getLookup(a.settings.api)),a.user_properties=new $.Onboarded.UserProperties,a.settings.apiVersion&&a.setAPIVersion(),a.$container||a.parseContainer(),a.project_token||a.parseProjectToken(),a.user||a.parseUser(),a.register(),a.parseFlows(),a.addRenderContainer(),a.setState("ready")}}(this)).add(function(a){return function(){return $(document).trigger("onboarded:afterLoad",[a])}}(this)).fire(),this},this},$.Onboarded.onboard.prototype.defaults={apiVersion:null},$.fn.onboard=function(a){return this.each(function(){var b;return void 0===$(this).data("onboarded")?(b=new $.Onboarded.onboard(this,a),b.init(),$(this).data("onboarded",b)):void 0})},window.Onboarded={retrieve:function(){var a;return null!=(a=$("body").data("onboarded"))?a:!1},load:function(a){var b;return null!=(b=$("body").data("onboarded"))?b:$("body").onboard(a).data("onboarded")},unload:function(){return $("body").removeData("onboarded")&&!0}}})}.call(this);