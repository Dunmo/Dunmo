if(!Array.prototype.find){Array.prototype.find=function(predicate){if(this==null){throw new TypeError("Array.prototype.find called on null or undefined")}if(typeof predicate!=="function"){throw new TypeError("predicate must be a function")}var list=Object(this);var length=list.length>>>0;var thisArg=arguments[1];var value;for(var i=0;i<length;i++){value=list[i];if(predicate.call(thisArg,value,i,list)){return value}}return undefined}}if(!Object.assign){Object.defineProperty(Object,"assign",{enumerable:false,configurable:true,writable:true,value:function(target,firstSource){"use strict";if(target===undefined||target===null){throw new TypeError("Cannot convert first argument to object")}var to=Object(target);for(var i=1;i<arguments.length;i++){var nextSource=arguments[i];if(nextSource===undefined||nextSource===null){continue}nextSource=Object(nextSource);var keysArray=Object.keys(Object(nextSource));for(var nextIndex=0,len=keysArray.length;nextIndex<len;nextIndex++){var nextKey=keysArray[nextIndex];var desc=Object.getOwnPropertyDescriptor(nextSource,nextKey);if(desc!==undefined&&desc.enumerable){to[nextKey]=nextSource[nextKey]}}}return to}})}!function(global){"use strict";var hasOwn=Object.prototype.hasOwnProperty;var undefined;var iteratorSymbol=typeof Symbol==="function"&&Symbol.iterator||"@@iterator";var inModule=typeof module==="object";var runtime=global.regeneratorRuntime;if(runtime){if(inModule){module.exports=runtime}return}runtime=global.regeneratorRuntime=inModule?module.exports:{};function wrap(innerFn,outerFn,self,tryLocsList){var generator=Object.create((outerFn||Generator).prototype);generator._invoke=makeInvokeMethod(innerFn,self||null,new Context(tryLocsList||[]));return generator}runtime.wrap=wrap;function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}var GenStateSuspendedStart="suspendedStart";var GenStateSuspendedYield="suspendedYield";var GenStateExecuting="executing";var GenStateCompleted="completed";var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype;GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype;GeneratorFunctionPrototype.constructor=GeneratorFunction;GeneratorFunction.displayName="GeneratorFunction";runtime.isGeneratorFunction=function(genFun){var ctor=typeof genFun==="function"&&genFun.constructor;return ctor?ctor===GeneratorFunction||(ctor.displayName||ctor.name)==="GeneratorFunction":false};runtime.mark=function(genFun){genFun.__proto__=GeneratorFunctionPrototype;genFun.prototype=Object.create(Gp);return genFun};runtime.async=function(innerFn,outerFn,self,tryLocsList){return new Promise(function(resolve,reject){var generator=wrap(innerFn,outerFn,self,tryLocsList);var callNext=step.bind(generator,"next");var callThrow=step.bind(generator,"throw");function step(method,arg){var record=tryCatch(generator[method],generator,arg);if(record.type==="throw"){reject(record.arg);return}var info=record.arg;if(info.done){resolve(info.value)}else{Promise.resolve(info.value).then(callNext,callThrow)}}callNext()})};function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function invoke(method,arg){if(state===GenStateExecuting){throw new Error("Generator is already running")}if(state===GenStateCompleted){return doneResult()}while(true){var delegate=context.delegate;if(delegate){if(method==="return"||method==="throw"&&delegate.iterator[method]===undefined){context.delegate=null;var returnMethod=delegate.iterator["return"];if(returnMethod){var record=tryCatch(returnMethod,delegate.iterator,arg);if(record.type==="throw"){method="throw";arg=record.arg;continue}}if(method==="return"){continue}}var record=tryCatch(delegate.iterator[method],delegate.iterator,arg);if(record.type==="throw"){context.delegate=null;method="throw";arg=record.arg;continue}method="next";arg=undefined;var info=record.arg;if(info.done){context[delegate.resultName]=info.value;context.next=delegate.nextLoc}else{state=GenStateSuspendedYield;return info}context.delegate=null}if(method==="next"){if(state===GenStateSuspendedYield){context.sent=arg}else{delete context.sent}}else if(method==="throw"){if(state===GenStateSuspendedStart){state=GenStateCompleted;throw arg}if(context.dispatchException(arg)){method="next";arg=undefined}}else if(method==="return"){context.abrupt("return",arg)}state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if(record.type==="normal"){state=context.done?GenStateCompleted:GenStateSuspendedYield;var info={value:record.arg,done:context.done};if(record.arg===ContinueSentinel){if(context.delegate&&method==="next"){arg=undefined}}else{return info}}else if(record.type==="throw"){state=GenStateCompleted;method="throw";arg=record.arg}}}}function defineGeneratorMethod(method){Gp[method]=function(arg){return this._invoke(method,arg)}}defineGeneratorMethod("next");defineGeneratorMethod("throw");defineGeneratorMethod("return");Gp[iteratorSymbol]=function(){return this};Gp.toString=function(){return"[object Generator]"};function pushTryEntry(locs){var entry={tryLoc:locs[0]};if(1 in locs){entry.catchLoc=locs[1]}if(2 in locs){entry.finallyLoc=locs[2];entry.afterLoc=locs[3]}this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal";delete record.arg;entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}];tryLocsList.forEach(pushTryEntry,this);this.reset()}runtime.keys=function(object){var keys=[];for(var key in object){keys.push(key)}keys.reverse();return function next(){while(keys.length){var key=keys.pop();if(key in object){next.value=key;next.done=false;return next}}next.done=true;return next}};function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod){return iteratorMethod.call(iterable)}if(typeof iterable.next==="function"){return iterable}if(!isNaN(iterable.length)){var i=-1,next=function next(){while(++i<iterable.length){if(hasOwn.call(iterable,i)){next.value=iterable[i];next.done=false;return next}}next.value=undefined;next.done=true;return next};return next.next=next}}return{next:doneResult}}runtime.values=values;function doneResult(){return{value:undefined,done:true}}Context.prototype={constructor:Context,reset:function(){this.prev=0;this.next=0;this.sent=undefined;this.done=false;this.delegate=null;this.tryEntries.forEach(resetTryEntry);for(var tempIndex=0,tempName;hasOwn.call(this,tempName="t"+tempIndex)||tempIndex<20;++tempIndex){this[tempName]=null}},stop:function(){this.done=true;var rootEntry=this.tryEntries[0];var rootRecord=rootEntry.completion;if(rootRecord.type==="throw"){throw rootRecord.arg}return this.rval},dispatchException:function(exception){if(this.done){throw exception}var context=this;function handle(loc,caught){record.type="throw";record.arg=exception;context.next=loc;return!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];var record=entry.completion;if(entry.tryLoc==="root"){return handle("end")}if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc");var hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}else if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else if(hasCatch){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}}else if(hasFinally){if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}if(finallyEntry&&(type==="break"||type==="continue")&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc){finallyEntry=null}var record=finallyEntry?finallyEntry.completion:{};record.type=type;record.arg=arg;if(finallyEntry){this.next=finallyEntry.finallyLoc}else{this.complete(record)}return ContinueSentinel},complete:function(record,afterLoc){if(record.type==="throw"){throw record.arg}if(record.type==="break"||record.type==="continue"){this.next=record.arg}else if(record.type==="return"){this.rval=record.arg;this.next="end"}else if(record.type==="normal"&&afterLoc){this.next=afterLoc}},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc){this.complete(entry.completion,entry.afterLoc);resetTryEntry(entry);return ContinueSentinel}}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(record.type==="throw"){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc};return ContinueSentinel}}}(typeof global==="object"?global:typeof window==="object"?window:typeof self==="object"?self:this);!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.dav=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj["default"]=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _co=_dereq_("co");var _co2=_interopRequireDefault(_co);var _url=_dereq_("url");var _url2=_interopRequireDefault(_url);var _calendars=_dereq_("./calendars");var _contacts=_dereq_("./contacts");var _fuzzy_url_equals=_dereq_("./fuzzy_url_equals");var _fuzzy_url_equals2=_interopRequireDefault(_fuzzy_url_equals);var _model=_dereq_("./model");var _namespace=_dereq_("./namespace");var ns=_interopRequireWildcard(_namespace);var _request=_dereq_("./request");var request=_interopRequireWildcard(_request);var debug=_dereq_("./debug")("dav:accounts");var defaults={accountType:"caldav",loadCollections:true,loadObjects:false};var serviceDiscovery=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(account,options){var endpoint,uri,req,xhr,_location;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:debug("Attempt service discovery.");endpoint=_url2["default"].parse(account.server);endpoint.protocol=endpoint.protocol||"http";uri=_url2["default"].format({protocol:endpoint.protocol,host:endpoint.host,pathname:"/.well-known/"+options.accountType});req=request.basic({method:"GET"});context$1$0.prev=5;context$1$0.next=8;return options.xhr.send(req,uri,{sandbox:options.sandbox});case 8:xhr=context$1$0.sent;if(!(xhr.status>=300&&xhr.status<400)){context$1$0.next=14;break}_location=xhr.getResponseHeader("Location");if(!(typeof _location==="string"&&_location.length)){context$1$0.next=14;break}debug("Discovery redirected to "+_location);return context$1$0.abrupt("return",_url2["default"].format({protocol:endpoint.protocol,host:endpoint.host,pathname:_location}));case 14:context$1$0.next=19;break;case 16:context$1$0.prev=16;context$1$0.t0=context$1$0["catch"](5);debug("Discovery failed... failover to the provided url");case 19:return context$1$0.abrupt("return",endpoint.href);case 20:case"end":return context$1$0.stop()}},callee$0$0,this,[[5,16]])}));var principalUrl=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(account,options){var req,res,container;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:debug("Fetch principal url from context path "+account.rootUrl+".");req=request.propfind({props:[{name:"current-user-principal",namespace:ns.DAV}],depth:0,mergeResponses:true});context$1$0.next=4;return options.xhr.send(req,account.rootUrl,{sandbox:options.sandbox});case 4:res=context$1$0.sent;container=res.props;debug("Received principal: "+container.currentUserPrincipal);return context$1$0.abrupt("return",_url2["default"].resolve(account.rootUrl,container.currentUserPrincipal));case 8:case"end":return context$1$0.stop()}},callee$0$0,this)}));var homeUrl=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(account,options){var prop,req,responses,response,container,href;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:debug("Fetch home url from principal url "+account.principalUrl+".");prop=undefined;if(options.accountType==="caldav"){prop={name:"calendar-home-set",namespace:ns.CALDAV}}else if(options.accountType==="carddav"){prop={name:"addressbook-home-set",namespace:ns.CARDDAV}}req=request.propfind({props:[prop]});context$1$0.next=6;return options.xhr.send(req,account.principalUrl,{sandbox:options.sandbox});case 6:responses=context$1$0.sent;response=responses.find(function(response){return(0,_fuzzy_url_equals2["default"])(account.principalUrl,response.href)});container=response.props;href=undefined;if(options.accountType==="caldav"){debug("Received home: "+container.calendarHomeSet);href=container.calendarHomeSet}else if(options.accountType==="carddav"){debug("Received home: "+container.addressbookHomeSet);href=container.addressbookHomeSet}return context$1$0.abrupt("return",_url2["default"].resolve(account.rootUrl,href));case 12:case"end":return context$1$0.stop()}},callee$0$0,this)}));exports.createAccount=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(options){var account,key,loadCollections,loadObjects,collections;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:options=Object.assign({},defaults,options);if(typeof options.loadObjects!=="boolean"){options.loadObjects=options.loadCollections}account=new _model.Account({server:options.server,credentials:options.xhr.credentials});context$1$0.next=5;return serviceDiscovery(account,options);case 5:account.rootUrl=context$1$0.sent;context$1$0.next=8;return principalUrl(account,options);case 8:account.principalUrl=context$1$0.sent;context$1$0.next=11;return homeUrl(account,options);case 11:account.homeUrl=context$1$0.sent;if(options.loadCollections){context$1$0.next=14;break}return context$1$0.abrupt("return",account);case 14:key=undefined,loadCollections=undefined,loadObjects=undefined;if(options.accountType==="caldav"){key="calendars";loadCollections=_calendars.listCalendars;loadObjects=_calendars.listCalendarObjects}else if(options.accountType==="carddav"){key="addressBooks";loadCollections=_contacts.listAddressBooks;loadObjects=_contacts.listVCards}context$1$0.next=18;return loadCollections(account,options);case 18:collections=context$1$0.sent;account[key]=collections;if(options.loadObjects){context$1$0.next=22;break}return context$1$0.abrupt("return",account);case 22:context$1$0.next=24;return collections.map(_co2["default"].wrap(regeneratorRuntime.mark(function callee$1$0(collection){return regeneratorRuntime.wrap(function callee$1$0$(context$2$0){while(1)switch(context$2$0.prev=context$2$0.next){case 0:context$2$0.prev=0;context$2$0.next=3;return loadObjects(collection,options);case 3:collection.objects=context$2$0.sent;context$2$0.next=9;break;case 6:context$2$0.prev=6;context$2$0.t0=context$2$0["catch"](0);collection.error=context$2$0.t0;case 9:case"end":return context$2$0.stop()}},callee$1$0,this,[[0,6]])})));case 24:account[key]=account[key].filter(function(collection){return!collection.error});return context$1$0.abrupt("return",account);case 26:case"end":return context$1$0.stop()}},callee$0$0,this)}))},{"./calendars":2,"./contacts":5,"./debug":6,"./fuzzy_url_equals":7,"./model":9,"./namespace":10,"./request":12,co:29,url:28}],2:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createCalendarObject=createCalendarObject;exports.updateCalendarObject=updateCalendarObject;exports.deleteCalendarObject=deleteCalendarObject;exports.syncCalendar=syncCalendar;function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj["default"]=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _co=_dereq_("co");var _co2=_interopRequireDefault(_co);var _url=_dereq_("url");var _url2=_interopRequireDefault(_url);var _fuzzy_url_equals=_dereq_("./fuzzy_url_equals");var _fuzzy_url_equals2=_interopRequireDefault(_fuzzy_url_equals);var _model=_dereq_("./model");var _namespace=_dereq_("./namespace");var ns=_interopRequireWildcard(_namespace);var _request=_dereq_("./request");var request=_interopRequireWildcard(_request);var _webdav=_dereq_("./webdav");var webdav=_interopRequireWildcard(_webdav);var debug=_dereq_("./debug")("dav:calendars");var listCalendars=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(account,options){var req,responses,cals;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:debug("Fetch calendars from home url "+account.homeUrl);req=request.propfind({props:[{name:"calendar-description",namespace:ns.CALDAV},{name:"calendar-timezone",namespace:ns.CALDAV},{name:"displayname",namespace:ns.DAV},{name:"getctag",namespace:ns.CALENDAR_SERVER},{name:"resourcetype",namespace:ns.DAV},{name:"supported-calendar-component-set",namespace:ns.CALDAV},{name:"sync-token",namespace:ns.DAV}],depth:1});context$1$0.next=4;return options.xhr.send(req,account.homeUrl,{sandbox:options.sandbox});case 4:responses=context$1$0.sent;debug("Found "+responses.length+" calendars.");cals=responses.filter(function(res){var components=res.props.supportedCalendarComponentSet;return components&&components.indexOf("VEVENT")!==-1}).map(function(res){debug("Found calendar "+res.props.displayname+",\n             props: "+JSON.stringify(res.props));return new _model.Calendar({data:res,account:account,description:res.props.calendarDescription,timezone:res.props.calendarTimezone,url:_url2["default"].resolve(account.rootUrl,res.href),ctag:res.props.getctag,displayName:res.props.displayname,components:res.props.supportedCalendarComponentSet,resourcetype:res.props.resourcetype,syncToken:res.props.syncToken})});context$1$0.next=9;return cals.map(_co2["default"].wrap(regeneratorRuntime.mark(function callee$1$0(cal){return regeneratorRuntime.wrap(function callee$1$0$(context$2$0){while(1)switch(context$2$0.prev=context$2$0.next){case 0:context$2$0.next=2;return webdav.supportedReportSet(cal,options);case 2:cal.reports=context$2$0.sent;case 3:case"end":return context$2$0.stop()}},callee$1$0,this)})));case 9:return context$1$0.abrupt("return",cals);case 10:case"end":return context$1$0.stop()}},callee$0$0,this)}));exports.listCalendars=listCalendars;function createCalendarObject(calendar,options){var objectUrl=_url2["default"].resolve(calendar.url,options.filename);return webdav.createObject(objectUrl,options.data,options)}function updateCalendarObject(calendarObject,options){return webdav.updateObject(calendarObject.url,calendarObject.calendarData,calendarObject.etag,options)}function deleteCalendarObject(calendarObject,options){return webdav.deleteObject(calendarObject.url,calendarObject.etag,options)}var listCalendarObjects=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(calendar,options){var filters,req,responses;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:debug("Doing REPORT on calendar "+calendar.url+" which belongs to\n         "+calendar.account.credentials.username);filters=options.filters||[{type:"comp-filter",attrs:{name:"VCALENDAR"},children:[{type:"comp-filter",attrs:{name:"VEVENT"}}]}];req=request.calendarQuery({depth:1,props:[{name:"getetag",namespace:ns.DAV},{name:"calendar-data",namespace:ns.CALDAV}],filters:filters});context$1$0.next=5;return options.xhr.send(req,calendar.url,{sandbox:options.sandbox});case 5:responses=context$1$0.sent;return context$1$0.abrupt("return",responses.map(function(res){debug("Found calendar object with url "+res.href);return new _model.CalendarObject({data:res,calendar:calendar,url:_url2["default"].resolve(calendar.account.rootUrl,res.href),etag:res.props.getetag,calendarData:res.props.calendarData})}));case 7:case"end":return context$1$0.stop()}},callee$0$0,this)}));exports.listCalendarObjects=listCalendarObjects;function syncCalendar(calendar,options){options.basicSync=basicSync;options.webdavSync=webdavSync;return webdav.syncCollection(calendar,options)}var syncCaldavAccount=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(account){var options=arguments[1]===undefined?{}:arguments[1];var cals;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:options.loadObjects=false;if(!account.calendars)account.calendars=[];context$1$0.next=4;return listCalendars(account,options);case 4:cals=context$1$0.sent;cals.filter(function(cal){return account.calendars.every(function(prev){return!(0,_fuzzy_url_equals2["default"])(prev.url,cal.url)})}).forEach(function(cal){account.calendars.push(cal)});options.loadObjects=true;context$1$0.next=9;return account.calendars.map(_co2["default"].wrap(regeneratorRuntime.mark(function callee$1$0(cal,index){return regeneratorRuntime.wrap(function callee$1$0$(context$2$0){while(1)switch(context$2$0.prev=context$2$0.next){case 0:context$2$0.prev=0;context$2$0.next=3;return syncCalendar(cal,options);case 3:context$2$0.next=9;break;case 5:context$2$0.prev=5;context$2$0.t0=context$2$0["catch"](0);debug("Sync calendar "+cal.displayName+" failed with "+context$2$0.t0);account.calendars.splice(index,1);case 9:case"end":return context$2$0.stop()}},callee$1$0,this,[[0,5]])})));case 9:return context$1$0.abrupt("return",account);case 10:case"end":return context$1$0.stop()}},callee$0$0,this)}));exports.syncCaldavAccount=syncCaldavAccount;var basicSync=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(calendar,options){var sync;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:context$1$0.next=2;return webdav.isCollectionDirty(calendar,options);case 2:sync=context$1$0.sent;if(sync){context$1$0.next=6;break}debug("Local ctag matched remote! No need to sync :).");return context$1$0.abrupt("return",calendar);case 6:debug("ctag changed so we need to fetch stuffs.");context$1$0.next=9;return listCalendarObjects(calendar,options);case 9:calendar.objects=context$1$0.sent;return context$1$0.abrupt("return",calendar);case 11:case"end":return context$1$0.stop()}},callee$0$0,this)}));var webdavSync=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(calendar,options){var req,result;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:req=request.syncCollection({props:[{name:"getetag",namespace:ns.DAV},{name:"calendar-data",namespace:ns.CALDAV}],syncLevel:1,syncToken:calendar.syncToken});context$1$0.next=3;return options.xhr.send(req,calendar.url,{sandbox:options.sandbox});case 3:result=context$1$0.sent;result.responses.forEach(function(response){var calendarObject=calendar.objects.filter(function(object){return(0,_fuzzy_url_equals2["default"])(object.url,response.href)})[0];if(!calendarObject){return}calendarObject.etag=response.props.getetag;calendarObject.calendarData=response.props.calendarData});calendar.syncToken=result.syncToken;return context$1$0.abrupt("return",calendar);case 7:case"end":return context$1$0.stop()}},callee$0$0,this)}))},{"./debug":6,"./fuzzy_url_equals":7,"./model":9,"./namespace":10,"./request":12,"./webdav":22,co:29,url:28}],3:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=camelize;function camelize(str){var delimiter=arguments[1]===undefined?"_":arguments[1];var words=str.split(delimiter);return[words[0]].concat(words.slice(1).map(function(word){return word.charAt(0).toUpperCase()+word.slice(1)})).join("")}module.exports=exports["default"]},{}],4:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj["default"]=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var _url=_dereq_("url");var _url2=_interopRequireDefault(_url);var _accounts=_dereq_("./accounts");var accounts=_interopRequireWildcard(_accounts);var _calendars=_dereq_("./calendars");var calendars=_interopRequireWildcard(_calendars);var _contacts=_dereq_("./contacts");var contacts=_interopRequireWildcard(_contacts);var Client=function(){function Client(xhr){var options=arguments[1]===undefined?{}:arguments[1];_classCallCheck(this,Client);this.xhr=xhr;Object.assign(this,options);this._accounts=accounts;this._calendars=calendars;this._contacts=contacts}_createClass(Client,[{key:"send",value:function send(req,uri,options){if(this.baseUrl){var urlObj=_url2["default"].parse(uri);uri=_url2["default"].resolve(this.baseUrl,urlObj.path)}return this.xhr.send(req,uri,options)}},{key:"createAccount",value:function createAccount(){var options=arguments[0]===undefined?{}:arguments[0];options.xhr=options.xhr||this.xhr;return accounts.createAccount(options)}},{key:"createCalendarObject",value:function createCalendarObject(calendar){var options=arguments[1]===undefined?{}:arguments[1];options.xhr=options.xhr||this.xhr;return calendars.createCalendarObject(calendar,options)}},{key:"updateCalendarObject",value:function updateCalendarObject(calendarObject){var options=arguments[1]===undefined?{}:arguments[1];options.xhr=options.xhr||this.xhr;return calendars.updateCalendarObject(calendarObject,options)}},{key:"deleteCalendarObject",value:function deleteCalendarObject(calendarObject){var options=arguments[1]===undefined?{}:arguments[1];options.xhr=options.xhr||this.xhr;return calendars.deleteCalendarObject(calendarObject,options)}},{key:"syncCalendar",value:function syncCalendar(calendar){var options=arguments[1]===undefined?{}:arguments[1];options.xhr=options.xhr||this.xhr;return calendars.syncCalendar(calendar,options)}},{key:"syncCaldavAccount",value:function syncCaldavAccount(account){var options=arguments[1]===undefined?{}:arguments[1];options.xhr=options.xhr||this.xhr;return calendars.syncCaldavAccount(account,options)}},{key:"createCard",value:function createCard(addressBook){var options=arguments[1]===undefined?{}:arguments[1];options.xhr=options.xhr||this.xhr;return contacts.createCard(addressBook,options)}},{key:"updateCard",value:function updateCard(card){var options=arguments[1]===undefined?{}:arguments[1];options.xhr=options.xhr||this.xhr;return contacts.updateCard(card,options)}},{key:"deleteCard",value:function deleteCard(card){var options=arguments[1]===undefined?{}:arguments[1];options.xhr=options.xhr||this.xhr;return contacts.deleteCard(card,options)}},{key:"syncAddressBook",value:function syncAddressBook(addressBook){var options=arguments[1]===undefined?{}:arguments[1];options.xhr=options.xhr||this.xhr;return contacts.syncAddressBook(addressBook,options)}},{key:"syncCarddavAccount",value:function syncCarddavAccount(account){var options=arguments[1]===undefined?{}:arguments[1];options.xhr=options.xhr||this.xhr;return contacts.syncCarddavAccount(account,options)}}]);return Client}();exports.Client=Client},{"./accounts":1,"./calendars":2,"./contacts":5,url:28}],5:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createCard=createCard;exports.updateCard=updateCard;exports.deleteCard=deleteCard;exports.syncAddressBook=syncAddressBook;function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj["default"]=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _co=_dereq_("co");var _co2=_interopRequireDefault(_co);var _url=_dereq_("url");var _url2=_interopRequireDefault(_url);var _fuzzy_url_equals=_dereq_("./fuzzy_url_equals");var _fuzzy_url_equals2=_interopRequireDefault(_fuzzy_url_equals);var _model=_dereq_("./model");var _namespace=_dereq_("./namespace");var ns=_interopRequireWildcard(_namespace);var _request=_dereq_("./request");var request=_interopRequireWildcard(_request);var _webdav=_dereq_("./webdav");var webdav=_interopRequireWildcard(_webdav);var debug=_dereq_("./debug")("dav:contacts");var listAddressBooks=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(account,options){var req,responses,addressBooks;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:debug("Fetch address books from home url "+account.homeUrl);req=request.propfind({props:[{name:"displayname",namespace:ns.DAV},{name:"getctag",namespace:ns.CALENDAR_SERVER},{name:"resourcetype",namespace:ns.DAV},{name:"sync-token",namespace:ns.DAV}],depth:1});context$1$0.next=4;return options.xhr.send(req,account.homeUrl,{sandbox:options.sandbox});case 4:responses=context$1$0.sent;addressBooks=responses.filter(function(res){return typeof res.props.displayname==="string"}).map(function(res){debug("Found address book named "+res.props.displayname+",\n             props: "+JSON.stringify(res.props));return new _model.AddressBook({data:res,account:account,url:_url2["default"].resolve(account.rootUrl,res.href),ctag:res.props.getctag,displayName:res.props.displayname,resourcetype:res.props.resourcetype,syncToken:res.props.syncToken})});context$1$0.next=8;return addressBooks.map(_co2["default"].wrap(regeneratorRuntime.mark(function callee$1$0(addressBook){return regeneratorRuntime.wrap(function callee$1$0$(context$2$0){while(1)switch(context$2$0.prev=context$2$0.next){case 0:context$2$0.next=2;return webdav.supportedReportSet(addressBook,options);case 2:addressBook.reports=context$2$0.sent;case 3:case"end":return context$2$0.stop()}},callee$1$0,this)
})));case 8:return context$1$0.abrupt("return",addressBooks);case 9:case"end":return context$1$0.stop()}},callee$0$0,this)}));exports.listAddressBooks=listAddressBooks;function createCard(addressBook,options){var objectUrl=_url2["default"].resolve(addressBook.url,options.filename);return webdav.createObject(objectUrl,options.data,options)}var listVCards=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(addressBook,options){var req,responses;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:debug("Doing REPORT on address book "+addressBook.url+" which belongs to\n        "+addressBook.account.credentials.username);req=request.addressBookQuery({depth:1,props:[{name:"getetag",namespace:ns.DAV},{name:"address-data",namespace:ns.CARDDAV}]});context$1$0.next=4;return options.xhr.send(req,addressBook.url,{sandbox:options.sandbox});case 4:responses=context$1$0.sent;return context$1$0.abrupt("return",responses.map(function(res){debug("Found vcard with url "+res.href);return new _model.VCard({data:res,addressBook:addressBook,url:_url2["default"].resolve(addressBook.account.rootUrl,res.href),etag:res.props.getetag,addressData:res.props.addressData})}));case 6:case"end":return context$1$0.stop()}},callee$0$0,this)}));exports.listVCards=listVCards;function updateCard(card,options){return webdav.updateObject(card.url,card.addressData,card.etag,options)}function deleteCard(card,options){return webdav.deleteObject(card.url,card.etag,options)}function syncAddressBook(addressBook,options){options.basicSync=basicSync;options.webdavSync=webdavSync;return webdav.syncCollection(addressBook,options)}var syncCarddavAccount=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(account){var options=arguments[1]===undefined?{}:arguments[1];var addressBooks;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:options.loadObjects=false;if(!account.addressBooks){account.addressBooks=[]}context$1$0.next=4;return listAddressBooks(account,options);case 4:addressBooks=context$1$0.sent;addressBooks.filter(function(addressBook){return account.addressBooks.every(function(prev){return!(0,_fuzzy_url_equals2["default"])(prev.url,addressBook.url)})}).forEach(function(addressBook){return account.addressBooks.push(addressBook)});options.loadObjects=true;context$1$0.next=9;return account.addressBooks.map(_co2["default"].wrap(regeneratorRuntime.mark(function callee$1$0(addressBook,index){return regeneratorRuntime.wrap(function callee$1$0$(context$2$0){while(1)switch(context$2$0.prev=context$2$0.next){case 0:context$2$0.prev=0;context$2$0.next=3;return syncAddressBook(addressBook,options);case 3:context$2$0.next=9;break;case 5:context$2$0.prev=5;context$2$0.t0=context$2$0["catch"](0);debug("Syncing "+addressBook.displayName+" failed with "+context$2$0.t0);account.addressBooks.splice(index,1);case 9:case"end":return context$2$0.stop()}},callee$1$0,this,[[0,5]])})));case 9:return context$1$0.abrupt("return",account);case 10:case"end":return context$1$0.stop()}},callee$0$0,this)}));exports.syncCarddavAccount=syncCarddavAccount;var basicSync=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(addressBook,options){var sync;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:sync=webdav.isCollectionDirty(addressBook,options);if(sync){context$1$0.next=4;break}debug("Local ctag matched remote! No need to sync :).");return context$1$0.abrupt("return",addressBook);case 4:debug("ctag changed so we need to fetch stuffs.");context$1$0.next=7;return listVCards(addressBook,options);case 7:addressBook.objects=context$1$0.sent;return context$1$0.abrupt("return",addressBook);case 9:case"end":return context$1$0.stop()}},callee$0$0,this)}));var webdavSync=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(addressBook,options){var req,result;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:req=request.syncCollection({props:[{name:"getetag",namespace:ns.DAV},{name:"address-data",namespace:ns.CARDDAV}],syncLevel:1,syncToken:addressBook.syncToken});context$1$0.next=3;return options.xhr.send(req,addressBook.url,{sandbox:options.sandbox});case 3:result=context$1$0.sent;result.responses.forEach(function(response){var vcard=addressBook.objects.filter(function(object){return(0,_fuzzy_url_equals2["default"])(object.url,response.href)})[0];if(!vcard)return;vcard.etag=response.props.getetag;vcard.addressData=response.props.addressData});addressBook.syncToken=result.syncToken;return context$1$0.abrupt("return",addressBook);case 7:case"end":return context$1$0.stop()}},callee$0$0,this)}))},{"./debug":6,"./fuzzy_url_equals":7,"./model":9,"./namespace":10,"./request":12,"./webdav":22,co:29,url:28}],6:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=debug;function debug(topic){return function(message){if(debug.enabled){console.log("["+topic+"] "+message)}}}module.exports=exports["default"]},{}],7:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=fuzzyUrlEquals;function fuzzyUrlEquals(one,other){return fuzzyIncludes(one,other)||fuzzyIncludes(other,one)}function fuzzyIncludes(one,other){return one.indexOf(other)!==-1||other.charAt(other.length-1)==="/"&&one.indexOf(other.slice(0,-1))!==-1}module.exports=exports["default"]},{}],8:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _defaults(obj,defaults){var keys=Object.getOwnPropertyNames(defaults);for(var i=0;i<keys.length;i++){var key=keys[i];var value=Object.getOwnPropertyDescriptor(defaults,key);if(value&&value.configurable&&obj[key]===undefined){Object.defineProperty(obj,key,value)}}return obj}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj["default"]=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _debug=_dereq_("./debug");var _debug2=_interopRequireDefault(_debug);var _namespace=_dereq_("./namespace");var ns=_interopRequireWildcard(_namespace);var _request=_dereq_("./request");var request=_interopRequireWildcard(_request);var _transport=_dereq_("./transport");var transport=_interopRequireWildcard(_transport);var _package=_dereq_("../package");Object.defineProperty(exports,"version",{enumerable:true,get:function get(){return _package.version}});var _accounts=_dereq_("./accounts");Object.defineProperty(exports,"createAccount",{enumerable:true,get:function get(){return _accounts.createAccount}});var _calendars=_dereq_("./calendars");_defaults(exports,_interopRequireWildcard(_calendars));var _client=_dereq_("./client");Object.defineProperty(exports,"Client",{enumerable:true,get:function get(){return _client.Client}});var _contacts=_dereq_("./contacts");_defaults(exports,_interopRequireWildcard(_contacts));var _model=_dereq_("./model");_defaults(exports,_interopRequireWildcard(_model));Object.defineProperty(exports,"Request",{enumerable:true,get:function get(){return _request.Request}});var _sandbox=_dereq_("./sandbox");Object.defineProperty(exports,"Sandbox",{enumerable:true,get:function get(){return _sandbox.Sandbox}});Object.defineProperty(exports,"createSandbox",{enumerable:true,get:function get(){return _sandbox.createSandbox}});exports.debug=_debug2["default"];exports.ns=ns;exports.request=request;exports.transport=transport},{"../package":33,"./accounts":1,"./calendars":2,"./client":4,"./contacts":5,"./debug":6,"./model":9,"./namespace":10,"./request":12,"./sandbox":13,"./transport":21}],9:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;desc=parent=getter=undefined;_again=false;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x=parent;_x2=property;_x3=receiver;_again=true;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Account=function Account(options){_classCallCheck(this,Account);Object.assign(this,{server:null,credentials:null,rootUrl:null,principalUrl:null,homeUrl:null,calendars:null,addressBooks:null},options)};exports.Account=Account;var Credentials=function Credentials(options){_classCallCheck(this,Credentials);Object.assign(this,{username:null,password:null,clientId:null,clientSecret:null,authorizationCode:null,redirectUrl:null,tokenUrl:null,accessToken:null,refreshToken:null,expiration:null},options)};exports.Credentials=Credentials;var DAVCollection=function DAVCollection(options){_classCallCheck(this,DAVCollection);Object.assign(this,{data:null,objects:null,account:null,ctag:null,description:null,displayName:null,reports:null,resourcetype:null,syncToken:null,url:null},options)};exports.DAVCollection=DAVCollection;var AddressBook=function(_DAVCollection){function AddressBook(options){_classCallCheck(this,AddressBook);_get(Object.getPrototypeOf(AddressBook.prototype),"constructor",this).call(this,options)}_inherits(AddressBook,_DAVCollection);return AddressBook}(DAVCollection);exports.AddressBook=AddressBook;var Calendar=function(_DAVCollection2){function Calendar(options){_classCallCheck(this,Calendar);_get(Object.getPrototypeOf(Calendar.prototype),"constructor",this).call(this,options);Object.assign(this,{components:null,timezone:null},options)}_inherits(Calendar,_DAVCollection2);return Calendar}(DAVCollection);exports.Calendar=Calendar;var DAVObject=function DAVObject(options){_classCallCheck(this,DAVObject);Object.assign(this,{data:null,etag:null,url:null},options)};exports.DAVObject=DAVObject;var CalendarObject=function(_DAVObject){function CalendarObject(options){_classCallCheck(this,CalendarObject);_get(Object.getPrototypeOf(CalendarObject.prototype),"constructor",this).call(this,options);Object.assign(this,{calendar:null,calendarData:null},options)}_inherits(CalendarObject,_DAVObject);return CalendarObject}(DAVObject);exports.CalendarObject=CalendarObject;var VCard=function(_DAVObject2){function VCard(options){_classCallCheck(this,VCard);_get(Object.getPrototypeOf(VCard.prototype),"constructor",this).call(this,options);Object.assign(this,{addressBook:null,addressData:null},options)}_inherits(VCard,_DAVObject2);return VCard}(DAVObject);exports.VCard=VCard},{}],10:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var CALENDAR_SERVER="http://calendarserver.org/ns/";exports.CALENDAR_SERVER=CALENDAR_SERVER;var CALDAV="urn:ietf:params:xml:ns:caldav";exports.CALDAV=CALDAV;var CARDDAV="urn:ietf:params:xml:ns:carddav";exports.CARDDAV=CARDDAV;var DAV="DAV:";exports.DAV=DAV},{}],11:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.multistatus=multistatus;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _camelize=_dereq_("./camelize");var _camelize2=_interopRequireDefault(_camelize);var debug=_dereq_("./debug")("dav:parser");var DOMParser=undefined;if(typeof self!=="undefined"&&"DOMParser"in self){DOMParser=self.DOMParser}else{DOMParser=_dereq_("xmldom").DOMParser}function multistatus(string){var parser=new DOMParser;var doc=parser.parseFromString(string,"text/xml");var result=traverse.multistatus(child(doc,"multistatus"));debug("input:\n"+string+"\noutput:\n"+JSON.stringify(result)+"\n");return result}var traverse={multistatus:function multistatus(node){return complex(node,{response:true})},response:function response(node){return complex(node,{propstat:true})},propstat:function propstat(node){return complex(node,{prop:false})},prop:function prop(node){return complex(node,{resourcetype:false,supportedCalendarComponentSet:false,supportedReportSet:false})},resourcetype:function resourcetype(node){return childNodes(node).map(function(childNode){return childNode.localName})},supportedCalendarComponentSet:function supportedCalendarComponentSet(node){return complex(node,{comp:true},"comp")},supportedReportSet:function supportedReportSet(node){return complex(node,{supportedReport:true},"supportedReport")},comp:function comp(node){return node.getAttribute("name")},supportedReport:function supportedReport(node){return complex(node,{report:false},"report")},report:function report(node){return childNodes(node).map(function(childNode){return childNode.localName})}};function complex(node,childspec,collapse){var result={};for(var key in childspec){if(childspec[key]){result[key]=[]}}childNodes(node).forEach(function(childNode){return traverseChild(node,childNode,childspec,result)});return maybeCollapse(result,childspec,collapse)}function traverseChild(node,childNode,childspec,result){if(childNode.nodeType===3&&/^\s+$/.test(childNode.nodeValue)){return}var localName=(0,_camelize2["default"])(childNode.localName,"-");if(!(localName in childspec)){debug("Unexpected node of type "+localName+" encountered while "+"parsing "+node.localName+" node!");var value=childNode.textContent;if(localName in result){if(!Array.isArray(result[camelCase])){result[localName]=[result[localName]]}result[localName].push(value);return}result[localName]=value;return}var traversal=traverse[localName](childNode);if(childspec[localName]){result[localName].push(traversal)}else{result[localName]=traversal}}function maybeCollapse(result,childspec,collapse){if(!collapse){return result}if(!childspec[collapse]){return result[collapse]}return result[collapse].reduce(function(a,b){return a.concat(b)},[])}function childNodes(node){var result=node.childNodes;if(!Array.isArray(result)){result=Array.prototype.slice.call(result)}return result}function children(node,localName){return childNodes(node).filter(function(childNode){return childNode.localName===localName})}function child(node,localName){return children(node,localName)[0]}},{"./camelize":3,"./debug":6,xmldom:30}],12:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.addressBookQuery=addressBookQuery;exports.basic=basic;exports.calendarQuery=calendarQuery;exports.collectionQuery=collectionQuery;exports.propfind=propfind;exports.syncCollection=syncCollection;exports.mergeProps=mergeProps;exports.getProps=getProps;exports.setRequestHeaders=setRequestHeaders;function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj["default"]=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var _parser=_dereq_("./parser");var _template=_dereq_("./template");var template=_interopRequireWildcard(_template);function addressBookQuery(options){return collectionQuery(template.addressBookQuery({props:options.props||[]}),{depth:options.depth})}function basic(options){function transformRequest(xhr){setRequestHeaders(xhr,options)}return new Request({method:options.method,requestData:options.data,transformRequest:transformRequest})}function calendarQuery(options){return collectionQuery(template.calendarQuery({props:options.props||[],filters:options.filters||[],timezone:options.timezone}),{depth:options.depth})}function collectionQuery(requestData,options){function transformRequest(xhr){setRequestHeaders(xhr,options)}function transformResponse(xhr){return(0,_parser.multistatus)(xhr.responseText).response.map(function(res){return{href:res.href,props:getProps(res.propstat)}})}return new Request({method:"REPORT",requestData:requestData,transformRequest:transformRequest,transformResponse:transformResponse})}function propfind(options){var requestData=template.propfind({props:options.props});function transformRequest(xhr){setRequestHeaders(xhr,options)}function transformResponse(xhr){var responses=(0,_parser.multistatus)(xhr.responseText).response.map(function(res){return{href:res.href,props:getProps(res.propstat)}});if(!options.mergeResponses){return responses}var merged=mergeProps(responses.map(function(res){return res.props}));var hrefs=responses.map(function(res){return res.href});return{props:merged,hrefs:hrefs}}return new Request({method:"PROPFIND",requestData:requestData,transformRequest:transformRequest,transformResponse:transformResponse})}function syncCollection(options){var requestData=template.syncCollection({props:options.props,syncLevel:options.syncLevel,syncToken:options.syncToken});function transformRequest(xhr){setRequestHeaders(xhr,options)}function transformResponse(xhr){var object=(0,_parser.multistatus)(xhr.responseText);var responses=object.response.map(function(res){return{href:res.href,props:getProps(res.propstat)}});return{responses:responses,syncToken:object.syncToken}}return new Request({method:"REPORT",requestData:requestData,transformRequest:transformRequest,transformResponse:transformResponse})}var Request=function Request(){var options=arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,Request);Object.assign(this,{method:null,requestData:null,transformRequest:null,transformResponse:null,onerror:null},options)};exports.Request=Request;function getProp(propstat){if(/404/g.test(propstat.status)){return null}if(/5\d{2}/g.test(propstat.status)||/4\d{2}/g.test(propstat.status)){throw new Error("Bad status on propstat: "+propstat.status)}return"prop"in propstat?propstat.prop:null}function mergeProps(props){return props.reduce(function(a,b){return Object.assign(a,b)},{})}function getProps(propstats){return mergeProps(propstats.map(getProp).filter(function(prop){return prop&&typeof prop==="object"}))}function setRequestHeaders(request,options){request.setRequestHeader("Content-Type","application/xml;charset=utf-8");if("depth"in options){request.setRequestHeader("Depth",options.depth)}if("etag"in options){request.setRequestHeader("If-Match",options.etag)}}},{"./parser":11,"./template":17}],13:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.createSandbox=createSandbox;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var debug=_dereq_("./debug")("dav:sandbox");var Sandbox=function(){function Sandbox(){_classCallCheck(this,Sandbox);this.requestList=[]}_createClass(Sandbox,[{key:"add",value:function add(request){debug("Adding request to sandbox.");this.requestList.push(request)}},{key:"abort",value:function abort(){debug("Aborting sandboxed requests.");this.requestList.forEach(function(request){return request.abort()})}}]);return Sandbox}();exports.Sandbox=Sandbox;function createSandbox(){return new Sandbox}},{"./debug":6}],14:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=addressBookQuery;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _prop=_dereq_("./prop");var _prop2=_interopRequireDefault(_prop);function addressBookQuery(object){return'<card:addressbook-query xmlns:card="urn:ietf:params:xml:ns:carddav"\n                          xmlns:d="DAV:">\n    <d:prop>\n      '+object.props.map(_prop2["default"])+"\n    </d:prop>\n    <!-- According to http://stackoverflow.com/questions/23742568/google-carddav-api-addressbook-multiget-returns-400-bad-request,\n         Google's CardDAV server requires a filter element. I don't think all addressbook-query calls need a filter in the spec though? -->\n    <card:filter>\n      <card:prop-filter name=\"FN\">\n      </card:prop-filter>\n    </card:filter>\n  </card:addressbook-query>"}module.exports=exports["default"]},{"./prop":18}],15:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=calendarQuery;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _filter=_dereq_("./filter");var _filter2=_interopRequireDefault(_filter);var _prop=_dereq_("./prop");var _prop2=_interopRequireDefault(_prop);function calendarQuery(object){return'<c:calendar-query xmlns:c="urn:ietf:params:xml:ns:caldav"\n                    xmlns:cs="http://calendarserver.org/ns/"\n                    xmlns:d="DAV:">\n    <d:prop>\n      '+object.props.map(_prop2["default"])+"\n    </d:prop>\n    <c:filter>\n      "+object.filters.map(_filter2["default"])+"\n    </c:filter>\n    "+(object.timezone?"<c:timezone>"+object.timezone+"</c:timezone>":"")+"\n  </c:calendar-query>"}module.exports=exports["default"]},{"./filter":16,"./prop":18}],16:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=filter;function filter(item){if(!item.children||!item.children.length){return"<c:"+item.type+" "+formatAttrs(item.attrs)+"/>"}var children=item.children.map(filter);return"<c:"+item.type+" "+formatAttrs(item.attrs)+">\n            "+children+"\n          </c:"+item.type+">"}function formatAttrs(attrs){if(typeof attrs!=="object"){return""}return Object.keys(attrs).map(function(attr){return""+attr+'="'+attrs[attr]+'"'}).join(" ")}module.exports=exports["default"]},{}],17:[function(_dereq_,module,exports){"use strict";exports.addressBookQuery=_dereq_("./address_book_query");exports.calendarQuery=_dereq_("./calendar_query");exports.propfind=_dereq_("./propfind");exports.syncCollection=_dereq_("./sync_collection")},{"./address_book_query":14,"./calendar_query":15,"./propfind":19,"./sync_collection":20}],18:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=prop;function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj["default"]=obj;return newObj}}var _namespace=_dereq_("../namespace");var ns=_interopRequireWildcard(_namespace);function prop(item){return"<"+xmlnsPrefix(item.namespace)+":"+item.name+" />"}function xmlnsPrefix(namespace){switch(namespace){case ns.DAV:return"d";case ns.CALENDAR_SERVER:return"cs";case ns.CALDAV:return"c";case ns.CARDDAV:return"card";default:throw new Error("Unrecognized xmlns "+namespace)}}module.exports=exports["default"]},{"../namespace":10}],19:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=propfind;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _prop=_dereq_("./prop");var _prop2=_interopRequireDefault(_prop);function propfind(object){return'<d:propfind xmlns:c="urn:ietf:params:xml:ns:caldav"\n              xmlns:card="urn:ietf:params:xml:ns:carddav"\n              xmlns:cs="http://calendarserver.org/ns/"\n              xmlns:d="DAV:">\n    <d:prop>\n      '+object.props.map(_prop2["default"])+"\n    </d:prop>\n  </d:propfind>"}module.exports=exports["default"]},{"./prop":18}],20:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=syncCollection;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _prop=_dereq_("./prop");var _prop2=_interopRequireDefault(_prop);function syncCollection(object){return'<d:sync-collection xmlns:c="urn:ietf:params:xml:ns:caldav"\n                     xmlns:card="urn:ietf:params:xml:ns:carddav"\n                     xmlns:d="DAV:">\n    <d:sync-level>'+object.syncLevel+"</d:sync-level>\n    <d:sync-token>"+object.syncToken+"</d:sync-token>\n    <d:prop>\n      "+object.props.map(_prop2["default"])+"\n    </d:prop>\n  </d:sync-collection>"}module.exports=exports["default"]},{"./prop":18}],21:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _get=function get(_x2,_x3,_x4){var _again=true;_function:while(_again){var object=_x2,property=_x3,receiver=_x4;desc=parent=getter=undefined;_again=false;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x2=parent;_x3=property;_x4=receiver;_again=true;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var _co=_dereq_("co");var _co2=_interopRequireDefault(_co);var _querystring=_dereq_("querystring");var _querystring2=_interopRequireDefault(_querystring);var _xmlhttprequest=_dereq_("./xmlhttprequest");var _xmlhttprequest2=_interopRequireDefault(_xmlhttprequest);var Transport=function(){function Transport(credentials){_classCallCheck(this,Transport);this.credentials=credentials||null}_createClass(Transport,[{key:"send",value:function send(){}}]);return Transport}();exports.Transport=Transport;var Basic=function(_Transport){function Basic(credentials){_classCallCheck(this,Basic);_get(Object.getPrototypeOf(Basic.prototype),"constructor",this).call(this,credentials)}_inherits(Basic,_Transport);_createClass(Basic,[{key:"send",value:function send(request,url,options){return(0,_co2["default"])(regeneratorRuntime.mark(function callee$2$0(){var sandbox,transformRequest,transformResponse,onerror,xhr,result;return regeneratorRuntime.wrap(function callee$2$0$(context$3$0){while(1)switch(context$3$0.prev=context$3$0.next){case 0:sandbox=options&&options.sandbox;transformRequest=request.transformRequest;transformResponse=request.transformResponse;onerror=request.onerror;xhr=new _xmlhttprequest2["default"];if(sandbox)sandbox.add(xhr);xhr.open(request.method,url,true,this.credentials.username,this.credentials.password);if(transformRequest)transformRequest(xhr);result=undefined;context$3$0.prev=9;context$3$0.next=12;return xhr.send(request.requestData);case 12:result=transformResponse?transformResponse(xhr):xhr;context$3$0.next=19;break;case 15:context$3$0.prev=15;context$3$0.t0=context$3$0["catch"](9);if(onerror)onerror(context$3$0.t0);throw context$3$0.t0;case 19:return context$3$0.abrupt("return",result);case 20:case"end":return context$3$0.stop()}},callee$2$0,this,[[9,15]])}).bind(this))}}]);return Basic}(Transport);exports.Basic=Basic;var OAuth2=function(_Transport2){function OAuth2(credentials){_classCallCheck(this,OAuth2);_get(Object.getPrototypeOf(OAuth2.prototype),"constructor",this).call(this,credentials)}_inherits(OAuth2,_Transport2);_createClass(OAuth2,[{key:"send",value:function send(request,url){var options=arguments[2]===undefined?{}:arguments[2];return(0,_co2["default"])(regeneratorRuntime.mark(function callee$2$0(){var sandbox,transformRequest,transformResponse,onerror,result,xhr,token;return regeneratorRuntime.wrap(function callee$2$0$(context$3$0){while(1)switch(context$3$0.prev=context$3$0.next){case 0:sandbox=options.sandbox;transformRequest=request.transformRequest;transformResponse=request.transformResponse;onerror=request.onerror;if(!("retry"in options))options.retry=true;result=undefined,xhr=undefined;context$3$0.prev=6;context$3$0.next=9;return access(this.credentials,options);case 9:token=context$3$0.sent;xhr=new _xmlhttprequest2["default"];if(sandbox)sandbox.add(xhr);xhr.open(request.method,url,true);xhr.setRequestHeader("Authorization","Bearer "+token);if(transformRequest)transformRequest(xhr);context$3$0.next=17;return xhr.send(request.requestData);case 17:result=transformResponse?transformResponse(xhr):xhr;context$3$0.next=28;break;case 20:context$3$0.prev=20;context$3$0.t0=context$3$0["catch"](6);if(!(options.retry&&xhr.status===401)){context$3$0.next=26;break}this.credentials.expiration=0;options.retry=false;return context$3$0.abrupt("return",this.send(request,url,options));case 26:if(onerror)onerror(context$3$0.t0);throw context$3$0.t0;case 28:return context$3$0.abrupt("return",result);case 29:case"end":return context$3$0.stop()}},callee$2$0,this,[[6,20]])}).bind(this))}}]);return OAuth2}(Transport);exports.OAuth2=OAuth2;function access(credentials,options){if(!credentials.accessToken){return getAccessToken(credentials,options)}if(credentials.refreshToken&&isExpired(credentials)){return refreshAccessToken(credentials,options)}return Promise.resolve(credentials.accessToken)}function isExpired(credentials){return typeof credentials.expiration==="number"&&Date.now()>credentials.expiration}var getAccessToken=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(credentials,options){var sandbox,xhr,data,now,response;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:sandbox=options.sandbox;xhr=new _xmlhttprequest2["default"];if(sandbox)sandbox.add(xhr);xhr.open("POST",credentials.tokenUrl,true);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");data=_querystring2["default"].stringify({code:credentials.authorizationCode,redirect_uri:credentials.redirectUrl,client_id:credentials.clientId,client_secret:credentials.clientSecret,grant_type:"authorization_code"});now=Date.now();context$1$0.next=9;return xhr.send(data);case 9:response=JSON.parse(xhr.responseText);credentials.accessToken=response.access_token;credentials.refreshToken="refresh_token"in response?response.refresh_token:null;
credentials.expiration="expires_in"in response?now+response.expires_in:null;return context$1$0.abrupt("return",response.access_token);case 14:case"end":return context$1$0.stop()}},callee$0$0,this)}));var refreshAccessToken=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(credentials,options){var sandbox,xhr,data,now,response;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:sandbox=options.sandbox;xhr=new _xmlhttprequest2["default"];if(sandbox)sandbox.add(xhr);xhr.open("POST",credentials.tokenUrl,true);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");data=_querystring2["default"].stringify({client_id:credentials.clientId,client_secret:credentials.clientSecret,refresh_token:credentials.refreshToken,grant_type:"refresh_token"});now=Date.now();context$1$0.next=9;return xhr.send(data);case 9:response=JSON.parse(xhr.responseText);credentials.accessToken=response.access_token;credentials.expiration="expires_in"in response?now+response.expires_in:null;return context$1$0.abrupt("return",response.access_token);case 13:case"end":return context$1$0.stop()}},callee$0$0,this)}))},{"./xmlhttprequest":23,co:29,querystring:27}],22:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createObject=createObject;exports.updateObject=updateObject;exports.deleteObject=deleteObject;exports.syncCollection=syncCollection;function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj["default"]=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _co=_dereq_("co");var _co2=_interopRequireDefault(_co);var _fuzzy_url_equals=_dereq_("./fuzzy_url_equals");var _fuzzy_url_equals2=_interopRequireDefault(_fuzzy_url_equals);var _namespace=_dereq_("./namespace");var ns=_interopRequireWildcard(_namespace);var _request=_dereq_("./request");var request=_interopRequireWildcard(_request);var debug=_dereq_("./debug")("dav:webdav");function createObject(objectUrl,objectData,options){var req=request.basic({method:"PUT",data:objectData});return options.xhr.send(req,objectUrl,{sandbox:options.sandbox})}function updateObject(objectUrl,objectData,etag,options){var req=request.basic({method:"PUT",data:objectData,etag:etag});return options.xhr.send(req,objectUrl,{sandbox:options.sandbox})}function deleteObject(objectUrl,etag,options){var req=request.basic({method:"DELETE",etag:etag});return options.xhr.send(req,objectUrl,{sandbox:options.sandbox})}function syncCollection(collection,options){var syncMethod=undefined;if("syncMethod"in options){syncMethod=options.syncMethod}else if(collection.reports&&collection.reports.indexOf("syncCollection")!==-1){syncMethod="webdav"}else{syncMethod="basic"}if(syncMethod==="webdav"){debug("rfc 6578 sync.");return options.webdavSync(collection,options)}else{debug("basic sync.");return options.basicSync(collection,options)}}var supportedReportSet=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(collection,options){var req,response;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:debug("Checking supported report set for collection at "+collection.url);req=request.propfind({props:[{name:"supported-report-set",namespace:ns.DAV}],depth:1,mergeResponses:true});context$1$0.next=4;return options.xhr.send(req,collection.url,{sandbox:options.sandbox});case 4:response=context$1$0.sent;return context$1$0.abrupt("return",response.props.supportedReportSet);case 6:case"end":return context$1$0.stop()}},callee$0$0,this)}));exports.supportedReportSet=supportedReportSet;var isCollectionDirty=_co2["default"].wrap(regeneratorRuntime.mark(function callee$0$0(collection,options){var req,responses,response;return regeneratorRuntime.wrap(function callee$0$0$(context$1$0){while(1)switch(context$1$0.prev=context$1$0.next){case 0:if(collection.ctag){context$1$0.next=3;break}debug("Missing ctag.");return context$1$0.abrupt("return",false);case 3:debug("Fetch remote getctag prop.");req=request.propfind({props:[{name:"getctag",namespace:ns.CALENDAR_SERVER}],depth:0});context$1$0.next=7;return options.xhr.send(req,collection.account.homeUrl,{sandbox:options.sandbox});case 7:responses=context$1$0.sent;response=responses.filter(function(response){return(0,_fuzzy_url_equals2["default"])(collection.url,response.href)})[0];if(response){context$1$0.next=11;break}throw new Error("Could not find collection on remote. Was it deleted?");case 11:debug("Check whether cached ctag matches remote.");return context$1$0.abrupt("return",collection.ctag!==response.props.getctag);case 13:case"end":return context$1$0.stop()}},callee$0$0,this)}));exports.isCollectionDirty=isCollectionDirty},{"./debug":6,"./fuzzy_url_equals":7,"./namespace":10,"./request":12,co:29}],23:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var debug=_dereq_("./debug")("dav:xmlhttprequest");var Native=undefined;if(typeof self!=="undefined"&&"XMLHttpRequest"in self){Native=self.XMLHttpRequest}else{Native=_dereq_(false||"xmlhttprequest").XMLHttpRequest}var XMLHttpRequest=function(){function XMLHttpRequest(options){var _this=this;_classCallCheck(this,XMLHttpRequest);this.request=new Native(options);this.sandbox=null;["response","responseText","responseType","responseXML","timeout","upload","withCredentials"].forEach(function(attribute){Object.defineProperty(_this,attribute,{get:function get(){return this.request[attribute]},set:function set(value){this.request[attribute]=value}})});["status","statusText"].forEach(function(attribute){Object.defineProperty(_this,attribute,{get:function get(){return this.request[attribute]}})})}_createClass(XMLHttpRequest,[{key:"abort",value:function abort(){return this._callNative("abort",arguments)}},{key:"getAllResponseHeaders",value:function getAllResponseHeaders(){return this._callNative("getAllResponseHeaders",arguments)}},{key:"getResponseHeader",value:function getResponseHeader(){return this._callNative("getResponseHeader",arguments)}},{key:"open",value:function open(){return this._callNative("open",arguments)}},{key:"overrideMimeType",value:function overrideMimeType(){return this._callNative("overrideMimeType",arguments)}},{key:"setRequestHeader",value:function setRequestHeader(){return this._callNative("setRequestHeader",arguments)}},{key:"send",value:function send(data){debug("Sending request data: "+data);if(this.sandbox)this.sandbox.add(this);var request=this.request;request.send(data);return new Promise(function(resolve,reject){request.onreadystatechange=function(){if(request.readyState!==4){return}if(request.status<200||request.status>=400){return reject(new Error("Bad status: "+request.status))}return resolve(request.responseText)};request.ontimeout=function(){reject(new Error("Request timed out after "+request.timeout+" ms"))}})}},{key:"_callNative",value:function _callNative(method,args){return this.request[method].apply(this.request,args)}}]);return XMLHttpRequest}();exports["default"]=XMLHttpRequest;module.exports=exports["default"]},{"./debug":6}],24:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports;var freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^ -~]/,regexSeparators=/\x2E|\u3002|\uFF0E|\uFF61/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw RangeError(errors[type])}function map(array,fn){var length=array.length;while(length--){array[length]=fn(array[length])}return array}function mapDomain(string,fn){return map(string.split(regexSeparators),fn).join(".")}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map(array,function(value){var output="";if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output}).join("")}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error("not-basic")}output.push(input.charCodeAt(j))}for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error("invalid-input")}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error("overflow")}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error("overflow")}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error("overflow")}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")}function toUnicode(domain){return mapDomain(domain,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(domain){return mapDomain(domain,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}punycode={version:"1.2.4",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define("punycode",function(){return punycode})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}})(this)}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],25:[function(_dereq_,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{}],26:[function(_dereq_,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},{}],27:[function(_dereq_,module,exports){"use strict";exports.decode=exports.parse=_dereq_("./decode");exports.encode=exports.stringify=_dereq_("./encode")},{"./decode":25,"./encode":26}],28:[function(_dereq_,module,exports){var punycode=_dereq_("punycode");exports.parse=urlParse;exports.resolve=urlResolve;exports.resolveObject=urlResolveObject;exports.format=urlFormat;exports.Url=Url;function Url(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,delims=["<",">",'"',"`"," ","\r","\n","	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:true,"javascript:":true},hostlessProtocol={javascript:true,"javascript:":true},slashedProtocol={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},querystring=_dereq_("querystring");function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&isObject(url)&&url instanceof Url)return url;var u=new Url;u.parse(url,parseQueryString,slashesDenoteHost);return u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!isString(url)){throw new TypeError("Parameter 'url' must be a string, not "+typeof url)}var rest=url;rest=rest.trim();var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto;rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==="//";if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);this.slashes=true}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var hostEnd=-1;for(var i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}var auth,atSign;if(hostEnd===-1){atSign=rest.lastIndexOf("@")}else{atSign=rest.lastIndexOf("@",hostEnd)}if(atSign!==-1){auth=rest.slice(0,atSign);rest=rest.slice(atSign+1);this.auth=decodeURIComponent(auth)}hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}if(hostEnd===-1)hostEnd=rest.length;this.host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd);this.parseHost();this.hostname=this.hostname||"";var ipv6Hostname=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ipv6Hostname){var hostparts=this.hostname.split(/\./);for(var i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!part)continue;if(!part.match(hostnamePartPattern)){var newpart="";for(var j=0,k=part.length;j<k;j++){if(part.charCodeAt(j)>127){newpart+="x"}else{newpart+=part[j]}}if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i);var notHost=hostparts.slice(i+1);var bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2])}if(notHost.length){rest="/"+notHost.join(".")+rest}this.hostname=validParts.join(".");break}}}}if(this.hostname.length>hostnameMaxLen){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!ipv6Hostname){var domainArray=this.hostname.split(".");var newOut=[];for(var i=0;i<domainArray.length;++i){var s=domainArray[i];newOut.push(s.match(/[^A-Za-z0-9_-]/)?"xn--"+punycode.encode(s):s)}this.hostname=newOut.join(".")}var p=this.port?":"+this.port:"";var h=this.hostname||"";this.host=h+p;this.href+=this.host;if(ipv6Hostname){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(rest[0]!=="/"){rest="/"+rest}}}if(!unsafeProtocol[lowerProto]){for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];var esc=encodeURIComponent(ae);if(esc===ae){esc=escape(ae)}rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");if(hash!==-1){this.hash=rest.substr(hash);rest=rest.slice(0,hash)}var qm=rest.indexOf("?");if(qm!==-1){this.search=rest.substr(qm);this.query=rest.substr(qm+1);if(parseQueryString){this.query=querystring.parse(this.query)}rest=rest.slice(0,qm)}else if(parseQueryString){this.search="";this.query={}}if(rest)this.pathname=rest;if(slashedProtocol[lowerProto]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var p=this.pathname||"";var s=this.search||"";this.path=p+s}this.href=this.format();return this};function urlFormat(obj){if(isString(obj))obj=urlParse(obj);if(!(obj instanceof Url))return Url.prototype.format.call(obj);return obj.format()}Url.prototype.format=function(){var auth=this.auth||"";if(auth){auth=encodeURIComponent(auth);auth=auth.replace(/%3A/i,":");auth+="@"}var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=false,query="";if(this.host){host=auth+this.host}else if(this.hostname){host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){host+=":"+this.port}}if(this.query&&isObject(this.query)&&Object.keys(this.query).length){query=querystring.stringify(this.query)}var search=this.search||query&&"?"+query||"";if(protocol&&protocol.substr(-1)!==":")protocol+=":";if(this.slashes||(!protocol||slashedProtocol[protocol])&&host!==false){host="//"+(host||"");if(pathname&&pathname.charAt(0)!=="/")pathname="/"+pathname}else if(!host){host=""}if(hash&&hash.charAt(0)!=="#")hash="#"+hash;if(search&&search.charAt(0)!=="?")search="?"+search;pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)});search=search.replace("#","%23");return protocol+host+pathname+search+hash};function urlResolve(source,relative){return urlParse(source,false,true).resolve(relative)}Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,false,true)).format()};function urlResolveObject(source,relative){if(!source)return relative;return urlParse(source,false,true).resolveObject(relative)}Url.prototype.resolveObject=function(relative){if(isString(relative)){var rel=new Url;rel.parse(relative,false,true);relative=rel}var result=new Url;Object.keys(this).forEach(function(k){result[k]=this[k]},this);result.hash=relative.hash;if(relative.href===""){result.href=result.format();return result}if(relative.slashes&&!relative.protocol){Object.keys(relative).forEach(function(k){if(k!=="protocol")result[k]=relative[k]});if(slashedProtocol[result.protocol]&&result.hostname&&!result.pathname){result.path=result.pathname="/"}result.href=result.format();return result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){Object.keys(relative).forEach(function(k){result[k]=relative[k]});result.href=result.format();return result}result.protocol=relative.protocol;if(!relative.host&&!hostlessProtocol[relative.protocol]){var relPath=(relative.pathname||"").split("/");while(relPath.length&&!(relative.host=relPath.shift()));if(!relative.host)relative.host="";if(!relative.hostname)relative.hostname="";if(relPath[0]!=="")relPath.unshift("");if(relPath.length<2)relPath.unshift("");result.pathname=relPath.join("/")}else{result.pathname=relative.pathname}result.search=relative.search;result.query=relative.query;result.host=relative.host||"";result.auth=relative.auth;result.hostname=relative.hostname||relative.host;result.port=relative.port;if(result.pathname||result.search){var p=result.pathname||"";var s=result.search||"";result.path=p+s}result.slashes=result.slashes||relative.slashes;result.href=result.format();return result}var isSourceAbs=result.pathname&&result.pathname.charAt(0)==="/",isRelAbs=relative.host||relative.pathname&&relative.pathname.charAt(0)==="/",mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic){result.hostname="";result.port=null;if(result.host){if(srcPath[0]==="")srcPath[0]=result.host;else srcPath.unshift(result.host)}result.host="";if(relative.protocol){relative.hostname=null;relative.port=null;if(relative.host){if(relPath[0]==="")relPath[0]=relative.host;else relPath.unshift(relative.host)}relative.host=null}mustEndAbs=mustEndAbs&&(relPath[0]===""||srcPath[0]==="")}if(isRelAbs){result.host=relative.host||relative.host===""?relative.host:result.host;result.hostname=relative.hostname||relative.hostname===""?relative.hostname:result.hostname;result.search=relative.search;result.query=relative.query;srcPath=relPath}else if(relPath.length){if(!srcPath)srcPath=[];srcPath.pop();srcPath=srcPath.concat(relPath);result.search=relative.search;result.query=relative.query}else if(!isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}result.search=relative.search;result.query=relative.query;if(!isNull(result.pathname)||!isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.href=result.format();return result}if(!srcPath.length){result.pathname=null;if(result.search){result.path="/"+result.search}else{result.path=null}result.href=result.format();return result}var last=srcPath.slice(-1)[0];var hasTrailingSlash=(result.host||relative.host)&&(last==="."||last==="..")||last==="";var up=0;for(var i=srcPath.length;i>=0;i--){last=srcPath[i];if(last=="."){srcPath.splice(i,1)}else if(last===".."){srcPath.splice(i,1);up++}else if(up){srcPath.splice(i,1);up--}}if(!mustEndAbs&&!removeAllDots){for(;up--;up){srcPath.unshift("..")}}if(mustEndAbs&&srcPath[0]!==""&&(!srcPath[0]||srcPath[0].charAt(0)!=="/")){srcPath.unshift("")}if(hasTrailingSlash&&srcPath.join("/").substr(-1)!=="/"){srcPath.push("")}var isAbsolute=srcPath[0]===""||srcPath[0]&&srcPath[0].charAt(0)==="/";if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}mustEndAbs=mustEndAbs||result.host&&srcPath.length;if(mustEndAbs&&!isAbsolute){srcPath.unshift("")}if(!srcPath.length){result.pathname=null;result.path=null}else{result.pathname=srcPath.join("/")}if(!isNull(result.pathname)||!isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.auth=relative.auth||result.auth;result.slashes=result.slashes||relative.slashes;result.href=result.format();return result};Url.prototype.parseHost=function(){var host=this.host;var port=portPattern.exec(host);if(port){port=port[0];if(port!==":"){this.port=port.substr(1)}host=host.substr(0,host.length-port.length)}if(host)this.hostname=host};function isString(arg){return typeof arg==="string"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isNull(arg){return arg===null}function isNullOrUndefined(arg){return arg==null}},{punycode:24,querystring:27}],29:[function(_dereq_,module,exports){var slice=Array.prototype.slice;module.exports=co["default"]=co.co=co;co.wrap=function(fn){createPromise.__generatorFunction__=fn;return createPromise;function createPromise(){return co.call(this,fn.apply(this,arguments))}};function co(gen){var ctx=this;return new Promise(function(resolve,reject){if(typeof gen==="function")gen=gen.call(ctx);if(!gen||typeof gen.next!=="function")return resolve(gen);onFulfilled();function onFulfilled(res){var ret;try{ret=gen.next(res)}catch(e){return reject(e)}next(ret)}function onRejected(err){var ret;try{ret=gen.throw(err)}catch(e){return reject(e)}next(ret)}function next(ret){if(ret.done)return resolve(ret.value);var value=toPromise.call(ctx,ret.value);if(value&&isPromise(value))return value.then(onFulfilled,onRejected);return onRejected(new TypeError("You may only yield a function, promise, generator, array, or object, "+'but the following object was passed: "'+String(ret.value)+'"'))}})}function toPromise(obj){if(!obj)return obj;if(isPromise(obj))return obj;if(isGeneratorFunction(obj)||isGenerator(obj))return co.call(this,obj);if("function"==typeof obj)return thunkToPromise.call(this,obj);if(Array.isArray(obj))return arrayToPromise.call(this,obj);if(isObject(obj))return objectToPromise.call(this,obj);return obj}function thunkToPromise(fn){var ctx=this;return new Promise(function(resolve,reject){fn.call(ctx,function(err,res){if(err)return reject(err);if(arguments.length>2)res=slice.call(arguments,1);resolve(res)})})}function arrayToPromise(obj){return Promise.all(obj.map(toPromise,this))}function objectToPromise(obj){var results=new obj.constructor;var keys=Object.keys(obj);var promises=[];for(var i=0;i<keys.length;i++){var key=keys[i];var promise=toPromise.call(this,obj[key]);if(promise&&isPromise(promise))defer(promise,key);else results[key]=obj[key]}return Promise.all(promises).then(function(){return results});function defer(promise,key){results[key]=undefined;promises.push(promise.then(function(res){results[key]=res}))}}function isPromise(obj){return"function"==typeof obj.then}function isGenerator(obj){return"function"==typeof obj.next&&"function"==typeof obj.throw}function isGeneratorFunction(obj){var constructor=obj.constructor;if(!constructor)return false;if("GeneratorFunction"===constructor.name||"GeneratorFunction"===constructor.displayName)return true;return isGenerator(constructor.prototype)}function isObject(val){return Object==val.constructor}},{}],30:[function(_dereq_,module,exports){function DOMParser(options){this.options=options||{locator:{}}}DOMParser.prototype.parseFromString=function(source,mimeType){var options=this.options;var sax=new XMLReader;var domBuilder=options.domBuilder||new DOMHandler;var errorHandler=options.errorHandler;var locator=options.locator;var defaultNSMap=options.xmlns||{};var entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};if(locator){domBuilder.setDocumentLocator(locator)}sax.errorHandler=buildErrorHandler(errorHandler,domBuilder,locator);sax.domBuilder=options.domBuilder||domBuilder;if(/\/x?html?$/.test(mimeType)){entityMap.nbsp=" ";entityMap.copy="©";defaultNSMap[""]="http://www.w3.org/1999/xhtml"}if(source){sax.parse(source,defaultNSMap,entityMap)}else{sax.errorHandler.error("invalid document source")}return domBuilder.document};function buildErrorHandler(errorImpl,domBuilder,locator){if(!errorImpl){if(domBuilder instanceof DOMHandler){return domBuilder}errorImpl=domBuilder}var errorHandler={};var isCallback=errorImpl instanceof Function;locator=locator||{};function build(key){var fn=errorImpl[key];if(!fn){if(isCallback){fn=errorImpl.length==2?function(msg){errorImpl(key,msg)}:errorImpl}else{var i=arguments.length;while(--i){if(fn=errorImpl[arguments[i]]){break}}}}errorHandler[key]=fn&&function(msg){fn(msg+_locator(locator))}||function(){}}build("warning","warn");build("error","warn","warning");build("fatalError","warn","warning","error");return errorHandler}function DOMHandler(){this.cdata=false}function position(locator,node){node.lineNumber=locator.lineNumber;node.columnNumber=locator.columnNumber}DOMHandler.prototype={startDocument:function(){this.document=(new DOMImplementation).createDocument(null,null,null);if(this.locator){this.document.documentURI=this.locator.systemId}},startElement:function(namespaceURI,localName,qName,attrs){var doc=this.document;var el=doc.createElementNS(namespaceURI,qName||localName);var len=attrs.length;appendElement(this,el);this.currentElement=el;this.locator&&position(this.locator,el);for(var i=0;i<len;i++){var namespaceURI=attrs.getURI(i);var value=attrs.getValue(i);var qName=attrs.getQName(i);var attr=doc.createAttributeNS(namespaceURI,qName);if(attr.getOffset){position(attr.getOffset(1),attr)}attr.value=attr.nodeValue=value;el.setAttributeNode(attr)}},endElement:function(namespaceURI,localName,qName){var current=this.currentElement;var tagName=current.tagName;this.currentElement=current.parentNode},startPrefixMapping:function(prefix,uri){},endPrefixMapping:function(prefix){},processingInstruction:function(target,data){var ins=this.document.createProcessingInstruction(target,data);this.locator&&position(this.locator,ins);appendElement(this,ins)},ignorableWhitespace:function(ch,start,length){},characters:function(chars,start,length){chars=_toString.apply(this,arguments);if(this.currentElement&&chars){if(this.cdata){var charNode=this.document.createCDATASection(chars);this.currentElement.appendChild(charNode)}else{var charNode=this.document.createTextNode(chars);this.currentElement.appendChild(charNode)}this.locator&&position(this.locator,charNode)
}},skippedEntity:function(name){},endDocument:function(){this.document.normalize()},setDocumentLocator:function(locator){if(this.locator=locator){locator.lineNumber=0}},comment:function(chars,start,length){chars=_toString.apply(this,arguments);var comm=this.document.createComment(chars);this.locator&&position(this.locator,comm);appendElement(this,comm)},startCDATA:function(){this.cdata=true},endCDATA:function(){this.cdata=false},startDTD:function(name,publicId,systemId){var impl=this.document.implementation;if(impl&&impl.createDocumentType){var dt=impl.createDocumentType(name,publicId,systemId);this.locator&&position(this.locator,dt);appendElement(this,dt)}},warning:function(error){console.warn(error,_locator(this.locator))},error:function(error){console.error(error,_locator(this.locator))},fatalError:function(error){console.error(error,_locator(this.locator));throw error}};function _locator(l){if(l){return"\n@"+(l.systemId||"")+"#[line:"+l.lineNumber+",col:"+l.columnNumber+"]"}}function _toString(chars,start,length){if(typeof chars=="string"){return chars.substr(start,length)}else{if(chars.length>=start+length||start){return new java.lang.String(chars,start,length)+""}return chars}}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(key){DOMHandler.prototype[key]=function(){return null}});function appendElement(hander,node){if(!hander.currentElement){hander.document.appendChild(node)}else{hander.currentElement.appendChild(node)}}if(typeof _dereq_=="function"){var XMLReader=_dereq_("./sax").XMLReader;var DOMImplementation=exports.DOMImplementation=_dereq_("./dom").DOMImplementation;exports.XMLSerializer=_dereq_("./dom").XMLSerializer;exports.DOMParser=DOMParser}},{"./dom":31,"./sax":32}],31:[function(_dereq_,module,exports){function copy(src,dest){for(var p in src){dest[p]=src[p]}}function _extends(Class,Super){var pt=Class.prototype;if(Object.create){var ppt=Object.create(Super.prototype);pt.__proto__=ppt}if(!(pt instanceof Super)){function t(){}t.prototype=Super.prototype;t=new t;copy(pt,t);Class.prototype=pt=t}if(pt.constructor!=Class){if(typeof Class!="function"){console.error("unknow Class:"+Class)}pt.constructor=Class}}var htmlns="http://www.w3.org/1999/xhtml";var NodeType={};var ELEMENT_NODE=NodeType.ELEMENT_NODE=1;var ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2;var TEXT_NODE=NodeType.TEXT_NODE=3;var CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4;var ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5;var ENTITY_NODE=NodeType.ENTITY_NODE=6;var PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7;var COMMENT_NODE=NodeType.COMMENT_NODE=8;var DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9;var DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10;var DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11;var NOTATION_NODE=NodeType.NOTATION_NODE=12;var ExceptionCode={};var ExceptionMessage={};var INDEX_SIZE_ERR=ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1);var DOMSTRING_SIZE_ERR=ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2);var HIERARCHY_REQUEST_ERR=ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3);var WRONG_DOCUMENT_ERR=ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4);var INVALID_CHARACTER_ERR=ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5);var NO_DATA_ALLOWED_ERR=ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6);var NO_MODIFICATION_ALLOWED_ERR=ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7);var NOT_FOUND_ERR=ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8);var NOT_SUPPORTED_ERR=ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9);var INUSE_ATTRIBUTE_ERR=ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10);var INVALID_STATE_ERR=ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11);var SYNTAX_ERR=ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12);var INVALID_MODIFICATION_ERR=ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13);var NAMESPACE_ERR=ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14);var INVALID_ACCESS_ERR=ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);function DOMException(code,message){if(message instanceof Error){var error=message}else{error=this;Error.call(this,ExceptionMessage[code]);this.message=ExceptionMessage[code];if(Error.captureStackTrace)Error.captureStackTrace(this,DOMException)}error.code=code;if(message)this.message=this.message+": "+message;return error}DOMException.prototype=Error.prototype;copy(ExceptionCode,DOMException);function NodeList(){}NodeList.prototype={length:0,item:function(index){return this[index]||null}};function LiveNodeList(node,refresh){this._node=node;this._refresh=refresh;_updateLiveList(this)}function _updateLiveList(list){var inc=list._node._inc||list._node.ownerDocument._inc;if(list._inc!=inc){var ls=list._refresh(list._node);__set__(list,"length",ls.length);copy(ls,list);list._inc=inc}}LiveNodeList.prototype.item=function(i){_updateLiveList(this);return this[i]};_extends(LiveNodeList,NodeList);function NamedNodeMap(){}function _findNodeIndex(list,node){var i=list.length;while(i--){if(list[i]===node){return i}}}function _addNamedNode(el,list,newAttr,oldAttr){if(oldAttr){list[_findNodeIndex(list,oldAttr)]=newAttr}else{list[list.length++]=newAttr}if(el){newAttr.ownerElement=el;var doc=el.ownerDocument;if(doc){oldAttr&&_onRemoveAttribute(doc,el,oldAttr);_onAddAttribute(doc,el,newAttr)}}}function _removeNamedNode(el,list,attr){var i=_findNodeIndex(list,attr);if(i>=0){var lastIndex=list.length-1;while(i<lastIndex){list[i]=list[++i]}list.length=lastIndex;if(el){var doc=el.ownerDocument;if(doc){_onRemoveAttribute(doc,el,attr);attr.ownerElement=null}}}else{throw DOMException(NOT_FOUND_ERR,new Error)}}NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(key){var i=this.length;while(i--){var attr=this[i];if(attr.nodeName==key){return attr}}},setNamedItem:function(attr){var el=attr.ownerElement;if(el&&el!=this._ownerElement){throw new DOMException(INUSE_ATTRIBUTE_ERR)}var oldAttr=this.getNamedItem(attr.nodeName);_addNamedNode(this._ownerElement,this,attr,oldAttr);return oldAttr},setNamedItemNS:function(attr){var el=attr.ownerElement,oldAttr;if(el&&el!=this._ownerElement){throw new DOMException(INUSE_ATTRIBUTE_ERR)}oldAttr=this.getNamedItemNS(attr.namespaceURI,attr.localName);_addNamedNode(this._ownerElement,this,attr,oldAttr);return oldAttr},removeNamedItem:function(key){var attr=this.getNamedItem(key);_removeNamedNode(this._ownerElement,this,attr);return attr},removeNamedItemNS:function(namespaceURI,localName){var attr=this.getNamedItemNS(namespaceURI,localName);_removeNamedNode(this._ownerElement,this,attr);return attr},getNamedItemNS:function(namespaceURI,localName){var i=this.length;while(i--){var node=this[i];if(node.localName==localName&&node.namespaceURI==namespaceURI){return node}}return null}};function DOMImplementation(features){this._features={};if(features){for(var feature in features){this._features=features[feature]}}}DOMImplementation.prototype={hasFeature:function(feature,version){var versions=this._features[feature.toLowerCase()];if(versions&&(!version||version in versions)){return true}else{return false}},createDocument:function(namespaceURI,qualifiedName,doctype){var doc=new Document;doc.doctype=doctype;if(doctype){doc.appendChild(doctype)}doc.implementation=this;doc.childNodes=new NodeList;if(qualifiedName){var root=doc.createElementNS(namespaceURI,qualifiedName);doc.appendChild(root)}return doc},createDocumentType:function(qualifiedName,publicId,systemId){var node=new DocumentType;node.name=qualifiedName;node.nodeName=qualifiedName;node.publicId=publicId;node.systemId=systemId;return node}};function Node(){}Node.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(newChild,refChild){return _insertBefore(this,newChild,refChild)},replaceChild:function(newChild,oldChild){this.insertBefore(newChild,oldChild);if(oldChild){this.removeChild(oldChild)}},removeChild:function(oldChild){return _removeChild(this,oldChild)},appendChild:function(newChild){return this.insertBefore(newChild,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(deep){return cloneNode(this.ownerDocument||this,this,deep)},normalize:function(){var child=this.firstChild;while(child){var next=child.nextSibling;if(next&&next.nodeType==TEXT_NODE&&child.nodeType==TEXT_NODE){this.removeChild(next);child.appendData(next.data)}else{child.normalize();child=next}}},isSupported:function(feature,version){return this.ownerDocument.implementation.hasFeature(feature,version)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(namespaceURI){var el=this;while(el){var map=el._nsMap;if(map){for(var n in map){if(map[n]==namespaceURI){return n}}}el=el.nodeType==2?el.ownerDocument:el.parentNode}return null},lookupNamespaceURI:function(prefix){var el=this;while(el){var map=el._nsMap;if(map){if(prefix in map){return map[prefix]}}el=el.nodeType==2?el.ownerDocument:el.parentNode}return null},isDefaultNamespace:function(namespaceURI){var prefix=this.lookupPrefix(namespaceURI);return prefix==null}};function _xmlEncoder(c){return c=="<"&&"&lt;"||c==">"&&"&gt;"||c=="&"&&"&amp;"||c=='"'&&"&quot;"||"&#"+c.charCodeAt()+";"}copy(NodeType,Node);copy(NodeType,Node.prototype);function _visitNode(node,callback){if(callback(node)){return true}if(node=node.firstChild){do{if(_visitNode(node,callback)){return true}}while(node=node.nextSibling)}}function Document(){}function _onAddAttribute(doc,el,newAttr){doc&&doc._inc++;var ns=newAttr.namespaceURI;if(ns=="http://www.w3.org/2000/xmlns/"){el._nsMap[newAttr.prefix?newAttr.localName:""]=newAttr.value}}function _onRemoveAttribute(doc,el,newAttr,remove){doc&&doc._inc++;var ns=newAttr.namespaceURI;if(ns=="http://www.w3.org/2000/xmlns/"){delete el._nsMap[newAttr.prefix?newAttr.localName:""]}}function _onUpdateChild(doc,el,newChild){if(doc&&doc._inc){doc._inc++;var cs=el.childNodes;if(newChild){cs[cs.length++]=newChild}else{var child=el.firstChild;var i=0;while(child){cs[i++]=child;child=child.nextSibling}cs.length=i}}}function _removeChild(parentNode,child){var previous=child.previousSibling;var next=child.nextSibling;if(previous){previous.nextSibling=next}else{parentNode.firstChild=next}if(next){next.previousSibling=previous}else{parentNode.lastChild=previous}_onUpdateChild(parentNode.ownerDocument,parentNode);return child}function _insertBefore(parentNode,newChild,nextChild){var cp=newChild.parentNode;if(cp){cp.removeChild(newChild)}if(newChild.nodeType===DOCUMENT_FRAGMENT_NODE){var newFirst=newChild.firstChild;if(newFirst==null){return newChild}var newLast=newChild.lastChild}else{newFirst=newLast=newChild}var pre=nextChild?nextChild.previousSibling:parentNode.lastChild;newFirst.previousSibling=pre;newLast.nextSibling=nextChild;if(pre){pre.nextSibling=newFirst}else{parentNode.firstChild=newFirst}if(nextChild==null){parentNode.lastChild=newLast}else{nextChild.previousSibling=newLast}do{newFirst.parentNode=parentNode}while(newFirst!==newLast&&(newFirst=newFirst.nextSibling));_onUpdateChild(parentNode.ownerDocument||parentNode,parentNode);if(newChild.nodeType==DOCUMENT_FRAGMENT_NODE){newChild.firstChild=newChild.lastChild=null}return newChild}function _appendSingleChild(parentNode,newChild){var cp=newChild.parentNode;if(cp){var pre=parentNode.lastChild;cp.removeChild(newChild);var pre=parentNode.lastChild}var pre=parentNode.lastChild;newChild.parentNode=parentNode;newChild.previousSibling=pre;newChild.nextSibling=null;if(pre){pre.nextSibling=newChild}else{parentNode.firstChild=newChild}parentNode.lastChild=newChild;_onUpdateChild(parentNode.ownerDocument,parentNode,newChild);return newChild}Document.prototype={nodeName:"#document",nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(newChild,refChild){if(newChild.nodeType==DOCUMENT_FRAGMENT_NODE){var child=newChild.firstChild;while(child){var next=child.nextSibling;this.insertBefore(child,refChild);child=next}return newChild}if(this.documentElement==null&&newChild.nodeType==1){this.documentElement=newChild}return _insertBefore(this,newChild,refChild),newChild.ownerDocument=this,newChild},removeChild:function(oldChild){if(this.documentElement==oldChild){this.documentElement=null}return _removeChild(this,oldChild)},importNode:function(importedNode,deep){return importNode(this,importedNode,deep)},getElementById:function(id){var rtv=null;_visitNode(this.documentElement,function(node){if(node.nodeType==1){if(node.getAttribute("id")==id){rtv=node;return true}}});return rtv},createElement:function(tagName){var node=new Element;node.ownerDocument=this;node.nodeName=tagName;node.tagName=tagName;node.childNodes=new NodeList;var attrs=node.attributes=new NamedNodeMap;attrs._ownerElement=node;return node},createDocumentFragment:function(){var node=new DocumentFragment;node.ownerDocument=this;node.childNodes=new NodeList;return node},createTextNode:function(data){var node=new Text;node.ownerDocument=this;node.appendData(data);return node},createComment:function(data){var node=new Comment;node.ownerDocument=this;node.appendData(data);return node},createCDATASection:function(data){var node=new CDATASection;node.ownerDocument=this;node.appendData(data);return node},createProcessingInstruction:function(target,data){var node=new ProcessingInstruction;node.ownerDocument=this;node.tagName=node.target=target;node.nodeValue=node.data=data;return node},createAttribute:function(name){var node=new Attr;node.ownerDocument=this;node.name=name;node.nodeName=name;node.localName=name;node.specified=true;return node},createEntityReference:function(name){var node=new EntityReference;node.ownerDocument=this;node.nodeName=name;return node},createElementNS:function(namespaceURI,qualifiedName){var node=new Element;var pl=qualifiedName.split(":");var attrs=node.attributes=new NamedNodeMap;node.childNodes=new NodeList;node.ownerDocument=this;node.nodeName=qualifiedName;node.tagName=qualifiedName;node.namespaceURI=namespaceURI;if(pl.length==2){node.prefix=pl[0];node.localName=pl[1]}else{node.localName=qualifiedName}attrs._ownerElement=node;return node},createAttributeNS:function(namespaceURI,qualifiedName){var node=new Attr;var pl=qualifiedName.split(":");node.ownerDocument=this;node.nodeName=qualifiedName;node.name=qualifiedName;node.namespaceURI=namespaceURI;node.specified=true;if(pl.length==2){node.prefix=pl[0];node.localName=pl[1]}else{node.localName=qualifiedName}return node}};_extends(Document,Node);function Element(){this._nsMap={}}Element.prototype={nodeType:ELEMENT_NODE,hasAttribute:function(name){return this.getAttributeNode(name)!=null},getAttribute:function(name){var attr=this.getAttributeNode(name);return attr&&attr.value||""},getAttributeNode:function(name){return this.attributes.getNamedItem(name)},setAttribute:function(name,value){var attr=this.ownerDocument.createAttribute(name);attr.value=attr.nodeValue=""+value;this.setAttributeNode(attr)},removeAttribute:function(name){var attr=this.getAttributeNode(name);attr&&this.removeAttributeNode(attr)},appendChild:function(newChild){if(newChild.nodeType===DOCUMENT_FRAGMENT_NODE){return this.insertBefore(newChild,null)}else{return _appendSingleChild(this,newChild)}},setAttributeNode:function(newAttr){return this.attributes.setNamedItem(newAttr)},setAttributeNodeNS:function(newAttr){return this.attributes.setNamedItemNS(newAttr)},removeAttributeNode:function(oldAttr){return this.attributes.removeNamedItem(oldAttr.nodeName)},removeAttributeNS:function(namespaceURI,localName){var old=this.getAttributeNodeNS(namespaceURI,localName);old&&this.removeAttributeNode(old)},hasAttributeNS:function(namespaceURI,localName){return this.getAttributeNodeNS(namespaceURI,localName)!=null},getAttributeNS:function(namespaceURI,localName){var attr=this.getAttributeNodeNS(namespaceURI,localName);return attr&&attr.value||""},setAttributeNS:function(namespaceURI,qualifiedName,value){var attr=this.ownerDocument.createAttributeNS(namespaceURI,qualifiedName);attr.value=attr.nodeValue=value;this.setAttributeNode(attr)},getAttributeNodeNS:function(namespaceURI,localName){return this.attributes.getNamedItemNS(namespaceURI,localName)},getElementsByTagName:function(tagName){return new LiveNodeList(this,function(base){var ls=[];_visitNode(base,function(node){if(node!==base&&node.nodeType==ELEMENT_NODE&&(tagName==="*"||node.tagName==tagName)){ls.push(node)}});return ls})},getElementsByTagNameNS:function(namespaceURI,localName){return new LiveNodeList(this,function(base){var ls=[];_visitNode(base,function(node){if(node!==base&&node.nodeType===ELEMENT_NODE&&node.namespaceURI===namespaceURI&&(localName==="*"||node.localName==localName)){ls.push(node)}});return ls})}};Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName;Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS;_extends(Element,Node);function Attr(){}Attr.prototype.nodeType=ATTRIBUTE_NODE;_extends(Attr,Node);function CharacterData(){}CharacterData.prototype={data:"",substringData:function(offset,count){return this.data.substring(offset,offset+count)},appendData:function(text){text=this.data+text;this.nodeValue=this.data=text;this.length=text.length},insertData:function(offset,text){this.replaceData(offset,0,text)},appendChild:function(newChild){throw new Error(ExceptionMessage[3]);return Node.prototype.appendChild.apply(this,arguments)},deleteData:function(offset,count){this.replaceData(offset,count,"")},replaceData:function(offset,count,text){var start=this.data.substring(0,offset);var end=this.data.substring(offset+count);text=start+text+end;this.nodeValue=this.data=text;this.length=text.length}};_extends(CharacterData,Node);function Text(){}Text.prototype={nodeName:"#text",nodeType:TEXT_NODE,splitText:function(offset){var text=this.data;var newText=text.substring(offset);text=text.substring(0,offset);this.data=this.nodeValue=text;this.length=text.length;var newNode=this.ownerDocument.createTextNode(newText);if(this.parentNode){this.parentNode.insertBefore(newNode,this.nextSibling)}return newNode}};_extends(Text,CharacterData);function Comment(){}Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE};_extends(Comment,CharacterData);function CDATASection(){}CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE};_extends(CDATASection,CharacterData);function DocumentType(){}DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE;_extends(DocumentType,Node);function Notation(){}Notation.prototype.nodeType=NOTATION_NODE;_extends(Notation,Node);function Entity(){}Entity.prototype.nodeType=ENTITY_NODE;_extends(Entity,Node);function EntityReference(){}EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE;_extends(EntityReference,Node);function DocumentFragment(){}DocumentFragment.prototype.nodeName="#document-fragment";DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE;_extends(DocumentFragment,Node);function ProcessingInstruction(){}ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE;_extends(ProcessingInstruction,Node);function XMLSerializer(){}XMLSerializer.prototype.serializeToString=function(node){var buf=[];serializeToString(node,buf);return buf.join("")};Node.prototype.toString=function(){return XMLSerializer.prototype.serializeToString(this)};function serializeToString(node,buf){switch(node.nodeType){case ELEMENT_NODE:var attrs=node.attributes;var len=attrs.length;var child=node.firstChild;var nodeName=node.tagName;var isHTML=htmlns===node.namespaceURI;buf.push("<",nodeName);for(var i=0;i<len;i++){serializeToString(attrs.item(i),buf,isHTML)}if(child||isHTML&&!/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){buf.push(">");if(isHTML&&/^script$/i.test(nodeName)){if(child){buf.push(child.data)}}else{while(child){serializeToString(child,buf);child=child.nextSibling}}buf.push("</",nodeName,">")}else{buf.push("/>")}return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:var child=node.firstChild;while(child){serializeToString(child,buf);child=child.nextSibling}return;case ATTRIBUTE_NODE:return buf.push(" ",node.name,'="',node.value.replace(/[<&"]/g,_xmlEncoder),'"');case TEXT_NODE:return buf.push(node.data.replace(/[<&]/g,_xmlEncoder));case CDATA_SECTION_NODE:return buf.push("<![CDATA[",node.data,"]]>");case COMMENT_NODE:return buf.push("<!--",node.data,"-->");case DOCUMENT_TYPE_NODE:var pubid=node.publicId;var sysid=node.systemId;buf.push("<!DOCTYPE ",node.name);if(pubid){buf.push(' PUBLIC "',pubid);if(sysid&&sysid!="."){buf.push('" "',sysid)}buf.push('">')}else if(sysid&&sysid!="."){buf.push(' SYSTEM "',sysid,'">')}else{var sub=node.internalSubset;if(sub){buf.push(" [",sub,"]")}buf.push(">")}return;case PROCESSING_INSTRUCTION_NODE:return buf.push("<?",node.target," ",node.data,"?>");case ENTITY_REFERENCE_NODE:return buf.push("&",node.nodeName,";");default:buf.push("??",node.nodeName)}}function importNode(doc,node,deep){var node2;switch(node.nodeType){case ELEMENT_NODE:node2=node.cloneNode(false);node2.ownerDocument=doc;case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:deep=true;break}if(!node2){node2=node.cloneNode(false)}node2.ownerDocument=doc;node2.parentNode=null;if(deep){var child=node.firstChild;while(child){node2.appendChild(importNode(doc,child,deep));child=child.nextSibling}}return node2}function cloneNode(doc,node,deep){var node2=new node.constructor;for(var n in node){var v=node[n];if(typeof v!="object"){if(v!=node2[n]){node2[n]=v}}}if(node.childNodes){node2.childNodes=new NodeList}node2.ownerDocument=doc;switch(node2.nodeType){case ELEMENT_NODE:var attrs=node.attributes;var attrs2=node2.attributes=new NamedNodeMap;var len=attrs.length;attrs2._ownerElement=node2;for(var i=0;i<len;i++){node2.setAttributeNode(cloneNode(doc,attrs.item(i),true))}break;case ATTRIBUTE_NODE:deep=true}if(deep){var child=node.firstChild;while(child){node2.appendChild(cloneNode(doc,child,deep));child=child.nextSibling}}return node2}function __set__(object,key,value){object[key]=value}try{if(Object.defineProperty){Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){_updateLiveList(this);return this.$$length}});Object.defineProperty(Node.prototype,"textContent",{get:function(){return getTextContent(this)},set:function(data){switch(this.nodeType){case 1:case 11:while(this.firstChild){this.removeChild(this.firstChild)}if(data||String(data)){this.appendChild(this.ownerDocument.createTextNode(data))}break;default:this.data=data;this.value=value;this.nodeValue=data}}});function getTextContent(node){switch(node.nodeType){case 1:case 11:var buf=[];node=node.firstChild;while(node){if(node.nodeType!==7&&node.nodeType!==8){buf.push(getTextContent(node))}node=node.nextSibling}return buf.join("");default:return node.nodeValue}}__set__=function(object,key,value){object["$$"+key]=value}}}catch(e){}if(typeof _dereq_=="function"){exports.DOMImplementation=DOMImplementation;exports.XMLSerializer=XMLSerializer}},{}],32:[function(_dereq_,module,exports){var nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/;var nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"·̀-ͯ\\ux203F-⁀]");var tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$");var S_TAG=0;var S_ATTR=1;var S_ATTR_S=2;var S_EQ=3;var S_V=4;var S_E=5;var S_S=6;var S_C=7;function XMLReader(){}XMLReader.prototype={parse:function(source,defaultNSMap,entityMap){var domBuilder=this.domBuilder;domBuilder.startDocument();_copy(defaultNSMap,defaultNSMap={});parse(source,defaultNSMap,entityMap,domBuilder,this.errorHandler);domBuilder.endDocument()}};function parse(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){function fixedFromCharCode(code){if(code>65535){code-=65536;var surrogate1=55296+(code>>10),surrogate2=56320+(code&1023);return String.fromCharCode(surrogate1,surrogate2)}else{return String.fromCharCode(code)}}function entityReplacer(a){var k=a.slice(1,-1);if(k in entityMap){return entityMap[k]}else if(k.charAt(0)==="#"){return fixedFromCharCode(parseInt(k.substr(1).replace("x","0x")))}else{errorHandler.error("entity not found:"+a);return a}}function appendText(end){var xt=source.substring(start,end).replace(/&#?\w+;/g,entityReplacer);locator&&position(start);domBuilder.characters(xt,0,end-start);start=end}function position(start,m){while(start>=endPos&&(m=linePattern.exec(source))){startPos=m.index;endPos=startPos+m[0].length;locator.lineNumber++}locator.columnNumber=start-startPos+1}var startPos=0;var endPos=0;var linePattern=/.+(?:\r\n?|\n)|.*$/g;var locator=domBuilder.locator;var parseStack=[{currentNSMap:defaultNSMapCopy}];var closeMap={};var start=0;while(true){var i=source.indexOf("<",start);if(i<0){if(!source.substr(start).match(/^\s*$/)){var doc=domBuilder.document;var text=doc.createTextNode(source.substr(start));doc.appendChild(text);domBuilder.currentElement=text}return}if(i>start){appendText(i)}switch(source.charAt(i+1)){case"/":var end=source.indexOf(">",i+3);var tagName=source.substring(i+2,end);var config=parseStack.pop();var localNSMap=config.localNSMap;if(config.tagName!=tagName){errorHandler.fatalError("end tag name: "+tagName+" is not match the current start tagName:"+config.tagName)}domBuilder.endElement(config.uri,config.localName,tagName);if(localNSMap){for(var prefix in localNSMap){domBuilder.endPrefixMapping(prefix)}}end++;break;case"?":locator&&position(i);end=parseInstruction(source,i,domBuilder);break;case"!":locator&&position(i);end=parseDCC(source,i,domBuilder,errorHandler);break;default:try{locator&&position(i);var el=new ElementAttributes;var end=parseElementStartPart(source,i,el,entityReplacer,errorHandler);var len=el.length;if(len&&locator){var backup=copyLocator(locator,{});for(var i=0;i<len;i++){var a=el[i];position(a.offset);a.offset=copyLocator(locator,{})}copyLocator(backup,locator)}if(!el.closed&&fixSelfClosed(source,end,el.tagName,closeMap)){el.closed=true;if(!entityMap.nbsp){errorHandler.warning("unclosed xml attribute")}}appendElement(el,domBuilder,parseStack);if(el.uri==="http://www.w3.org/1999/xhtml"&&!el.closed){end=parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder)}else{end++}}catch(e){errorHandler.error("element parse error: "+e);end=-1}}if(end<0){appendText(i+1)}else{start=end}}}function copyLocator(f,t){t.lineNumber=f.lineNumber;t.columnNumber=f.columnNumber;return t}function parseElementStartPart(source,start,el,entityReplacer,errorHandler){var attrName;var value;var p=++start;var s=S_TAG;while(true){var c=source.charAt(p);switch(c){case"=":if(s===S_ATTR){attrName=source.slice(start,p);s=S_EQ}else if(s===S_ATTR_S){s=S_EQ}else{throw new Error("attribute equal must after attrName")}break;case"'":case'"':if(s===S_EQ){start=p+1;p=source.indexOf(c,start);if(p>0){value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);el.add(attrName,value,start-1);s=S_E}else{throw new Error("attribute value no end '"+c+"' match")}}else if(s==S_V){value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);el.add(attrName,value,start);errorHandler.warning('attribute "'+attrName+'" missed start quot('+c+")!!");start=p+1;s=S_E}else{throw new Error('attribute value must after "="')}break;case"/":switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_E:case S_S:case S_C:s=S_C;el.closed=true;case S_V:case S_ATTR:case S_ATTR_S:break;default:throw new Error("attribute invalid close char('/')")}break;case"":errorHandler.error("unexpected end of input");case">":switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_E:case S_S:case S_C:break;case S_V:case S_ATTR:value=source.slice(start,p);if(value.slice(-1)==="/"){el.closed=true;value=value.slice(0,-1)}case S_ATTR_S:if(s===S_ATTR_S){value=attrName}if(s==S_V){errorHandler.warning('attribute "'+value+'" missed quot(")!!');el.add(attrName,value.replace(/&#?\w+;/g,entityReplacer),start)}else{errorHandler.warning('attribute "'+value+'" missed value!! "'+value+'" instead!!');el.add(value,value,start)}break;case S_EQ:throw new Error("attribute value missed!!")}return p;case"":c=" ";default:if(c<=" "){switch(s){case S_TAG:el.setTagName(source.slice(start,p));s=S_S;break;case S_ATTR:attrName=source.slice(start,p);s=S_ATTR_S;break;case S_V:var value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);errorHandler.warning('attribute "'+value+'" missed quot(")!!');el.add(attrName,value,start);case S_E:s=S_S;break}}else{switch(s){case S_ATTR_S:errorHandler.warning('attribute "'+attrName+'" missed value!! "'+attrName+'" instead!!');el.add(attrName,attrName,start);start=p;s=S_ATTR;break;case S_E:errorHandler.warning('attribute space is required"'+attrName+'"!!');case S_S:s=S_ATTR;start=p;break;case S_EQ:s=S_V;start=p;break;case S_C:throw new Error("elements closed character '/' and '>' must be connected to")}}}p++}}function appendElement(el,domBuilder,parseStack){var tagName=el.tagName;var localNSMap=null;var currentNSMap=parseStack[parseStack.length-1].currentNSMap;var i=el.length;while(i--){var a=el[i];var qName=a.qName;var value=a.value;var nsp=qName.indexOf(":");if(nsp>0){var prefix=a.prefix=qName.slice(0,nsp);var localName=qName.slice(nsp+1);var nsPrefix=prefix==="xmlns"&&localName}else{localName=qName;prefix=null;nsPrefix=qName==="xmlns"&&""}a.localName=localName;if(nsPrefix!==false){if(localNSMap==null){localNSMap={};_copy(currentNSMap,currentNSMap={})}currentNSMap[nsPrefix]=localNSMap[nsPrefix]=value;a.uri="http://www.w3.org/2000/xmlns/";domBuilder.startPrefixMapping(nsPrefix,value)}}var i=el.length;while(i--){a=el[i];var prefix=a.prefix;if(prefix){if(prefix==="xml"){a.uri="http://www.w3.org/XML/1998/namespace"}if(prefix!=="xmlns"){a.uri=currentNSMap[prefix]}}}var nsp=tagName.indexOf(":");if(nsp>0){prefix=el.prefix=tagName.slice(0,nsp);localName=el.localName=tagName.slice(nsp+1)}else{prefix=null;localName=el.localName=tagName}var ns=el.uri=currentNSMap[prefix||""];domBuilder.startElement(ns,localName,tagName,el);if(el.closed){domBuilder.endElement(ns,localName,tagName);if(localNSMap){for(prefix in localNSMap){domBuilder.endPrefixMapping(prefix)}}}else{el.currentNSMap=currentNSMap;el.localNSMap=localNSMap;parseStack.push(el)}}function parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){if(/^(?:script|textarea)$/i.test(tagName)){var elEndStart=source.indexOf("</"+tagName+">",elStartEnd);var text=source.substring(elStartEnd+1,elEndStart);if(/[&<]/.test(text)){if(/^script$/i.test(tagName)){domBuilder.characters(text,0,text.length);return elEndStart}text=text.replace(/&#?\w+;/g,entityReplacer);domBuilder.characters(text,0,text.length);return elEndStart}}return elStartEnd+1}function fixSelfClosed(source,elStartEnd,tagName,closeMap){var pos=closeMap[tagName];if(pos==null){pos=closeMap[tagName]=source.lastIndexOf("</"+tagName+">")}return pos<elStartEnd}function _copy(source,target){for(var n in source){target[n]=source[n]}}function parseDCC(source,start,domBuilder,errorHandler){var next=source.charAt(start+2);switch(next){case"-":if(source.charAt(start+3)==="-"){var end=source.indexOf("-->",start+4);if(end>start){domBuilder.comment(source,start+4,end-start-4);return end+3}else{errorHandler.error("Unclosed comment");return-1}}else{return-1}default:if(source.substr(start+3,6)=="CDATA["){var end=source.indexOf("]]>",start+9);domBuilder.startCDATA();domBuilder.characters(source,start+9,end-start-9);
domBuilder.endCDATA();return end+3}var matchs=split(source,start);var len=matchs.length;if(len>1&&/!doctype/i.test(matchs[0][0])){var name=matchs[1][0];var pubid=len>3&&/^public$/i.test(matchs[2][0])&&matchs[3][0];var sysid=len>4&&matchs[4][0];var lastMatch=matchs[len-1];domBuilder.startDTD(name,pubid&&pubid.replace(/^(['"])(.*?)\1$/,"$2"),sysid&&sysid.replace(/^(['"])(.*?)\1$/,"$2"));domBuilder.endDTD();return lastMatch.index+lastMatch[0].length}}return-1}function parseInstruction(source,start,domBuilder){var end=source.indexOf("?>",start);if(end){var match=source.substring(start,end).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(match){var len=match[0].length;domBuilder.processingInstruction(match[1],match[2]);return end+2}else{return-1}}return-1}function ElementAttributes(source){}ElementAttributes.prototype={setTagName:function(tagName){if(!tagNamePattern.test(tagName)){throw new Error("invalid tagName:"+tagName)}this.tagName=tagName},add:function(qName,value,offset){if(!tagNamePattern.test(qName)){throw new Error("invalid attribute:"+qName)}this[this.length++]={qName:qName,value:value,offset:offset}},length:0,getLocalName:function(i){return this[i].localName},getOffset:function(i){return this[i].offset},getQName:function(i){return this[i].qName},getURI:function(i){return this[i].uri},getValue:function(i){return this[i].value}};function _set_proto_(thiz,parent){thiz.__proto__=parent;return thiz}if(!(_set_proto_({},_set_proto_.prototype)instanceof _set_proto_)){_set_proto_=function(thiz,parent){function p(){}p.prototype=parent;p=new p;for(parent in thiz){p[parent]=thiz[parent]}return p}}function split(source,start){var match;var buf=[];var reg=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;reg.lastIndex=start;reg.exec(source);while(match=reg.exec(source)){buf.push(match);if(match[1])return buf}}if(typeof _dereq_=="function"){exports.XMLReader=XMLReader}},{}],33:[function(_dereq_,module,exports){module.exports={name:"dav",version:"1.7.6",author:"Gareth Aye [:gaye] <gaye@mozilla.com>",description:"WebDAV, CalDAV, and CardDAV client for nodejs and the browser",license:"MPL-2.0",main:"./dav.js",repository:"https://github.com/gaye/dav",keywords:["address book","calendar","contacts","dav","caldav","carddav","webdav","ical","vcard","sync","rfc 4791","rfc 6352","rfc 6578"],dependencies:{co:"4.5.2",xmldom:"0.1.19",xmlhttprequest:"1.6.0"},devDependencies:{babel:"5.2.1",browserify:"4.1.5",chai:"1.9.1",doctoc:"0.7.1",mocha:"1.19.0",nock:"0.32.3",sinon:"1.10.0","tcp-port-used":"0.1.2","uglify-js":"2.4.14"},scripts:{test:"make test"}}},{}]},{},[8])(8)});
//# sourceMappingURL=./dav.js.map